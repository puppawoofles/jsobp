<!DOCTYPE html>
<html>
        <!-- Icon Hints: âš”ï¸âš¾ðŸ¹â˜„ï¸ðŸ›¡ï¸ðŸ”¨ðŸ”®ðŸ¤²ðŸ¥¾âœ¨ðŸ’«ðŸ³ï¸ -->
    <head><title>Where moves and movegen go hide.</title></head>
    <body>

        <move-gen name="punch">
            <bp>
                <appearance move_icon="âœŠ"></appearance>
                <target-mode target-type="hostile" target-mode="AT"></target-mode>
                <info invoke-fn="AttackMove.invoke"></info>

                <goap-pnode n="punch_move_node">
                    <req n="at_location" mode="target"></req>
                </goap-pnode>
            </bp>
            <gen>
                <add tag="damage"></add>
            </gen>
        </move-gen>

        <move-gen name="strike">
            <bp>
                <appearance move_icon="âš”ï¸"></appearance>
                <target-mode target-type="hostile" target-mode="AT"></target-mode>
                <target-mode target-type="hostile" target-mode="SZ"></target-mode>
                <target-mode target-type="hostile" target-mode="AZ" effective-from="F1 F2 F3"></target-mode>
                <info invoke-fn="AttackMove.invoke" resolve-target-fn="MoveUtils.MeleeTarget"></info>	

                <goap-pnode n="strike_move_node">
                    <req n="at_location" mode="target"></req>
                </goap-pnode>
            </bp>
            <gen>
                <add tag="damage"></add>
            </gen>
        </move-gen>

        <move-gen name="shoot">
            <bp>
                <appearance move_icon="ðŸ¹"></appearance>
                <!-- TODO: Figure out how to configure being able to bypass a barricade. -->
                <target-mode target-type="hostile" target-mode="AZ" effective-from="M1 M2 M3"></target-mode>
                <info invoke-fn="AttackMove.invoke"></info>	

                <goap-pnode n="shoot_move_node">
                    <req n="at_location" mode="target"></req>
                </goap-pnode>
            </bp>
            <gen>
                <add tag="damage"></add>
            </gen>
        </move-gen>

        <move-gen name="step">
            <bp>
                <appearance move_icon="ðŸ¥¾"></appearance>
                <!-- Not active if the destination has been reached.  -->
                <active-mode active-fn="MoveUtils.UserNotInTargetLocation"></active-mode>
                <target-mode target-type="self"></target-mode>
                <info invoke-fn="StepMove.invoke"></info>

                <goap-pnode n="step_move_node">
                    <req n="unobstructed_path_to_dest"></req>
                </goap-pnode>
            </bp>
            <gen>
                <add tag="movement"></add>
            </gen>
        </move-gen>

        <move-gen name="flee">
            <bp>
                <appearance move_icon="ðŸ³ï¸"></appearance>
                <!-- Not active if the unit isn't on an escapable square  -->
                <active-mode active-fn="MoveUtils.UserInMatchingTeamCell" cell-selector="[tag~=escape]"></active-mode>
                <target-mode target-type="self"></target-mode>
                <info invoke-fn="RetreatMove.invoke"></info>

                <goap-pnode n="flee_move_node">
                    <req n="at_location" matching="[tag~=escape]" team="allied"></req>
                </goap-pnode>

            </bp>
            <gen>
                <add tag="flee"></add>
            </gen>

        </move-gen>
        
        <move-gen name="hoof_bash">
            <bp>
                <appearance move_icon="âš”ï¸"></appearance>
                <!-- Not active if the unit isn't on an escapable square  -->
                <target-mode target-type="hostile" target-mode="AT"></target-mode>
                <info invoke-fn="AttackMove.invoke" resolve-target-fn="MoveUtils.MeleeTarget"></info>	

                <goap-pnode n="hoof_bash_move_node">
                    <req n="at_location" mode="move_target"></req>
                </goap-pnode>
            </bp>
            <gen>
                <add tag="damage"></add>
            </gen>


        </move-gen>

        <!-- Movesets (temporary: these should be on weapons!) -->
        <move-slot-gen name="sharp_stick">
            <bp>
                <appearance moveset_name="Sharp Stick"></appearance>
            </bp>
            <gen>
                <copyDest moveset_name="Sharp Stick"></copyDest>
                <setMoves>
                    <move-gen base="${SELF}.strike">
                        <priority value="0"></priority>
                    </move-gen>
                </setMoves>
            </gen>
        </move-slot-gen>

        <move-slot-gen name="rocks">
            <bp>
                <description>Bash an adjacent enemy with a rock, otherwise throw one at a further enemy.</description>
            </bp>
            <gen>
                <copyDest moveset_name="Rocks"></copyDest>
                <setMoves>
                    <move-gen base="${SELF}.punch">
                        <priority value="0"></priority>
                    </move-gen>
                    <move-gen base="${SELF}.shoot">
                        <priority value="-1"></priority>
                    </move-gen>
                </setMoves>
            </gen>
        </move-slot-gen>

        <!-- Moveset: This is what humans start with. -->
        <move-slot-gen name="base_human">
            <bp>
                <appearance moveset_name="Fists"></appearance>
            </bp>
            <gen>
                <copyDest moveset_name="Fists"></copyDest>
                <setMoves>
                    <move-gen base="${SELF}.punch">
                        <priority value="0"></priority>
                    </move-gen>
                </setMoves>
            </gen>
        </move-slot-gen>


    </body>
</html>