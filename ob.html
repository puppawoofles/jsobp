<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<title>JSOBP</title>

	<link rel="stylesheet" href="ob.css" />
	<style type="text/css"></style>
	<!-- Load code at the top -->
	<script src="woof/loader.js"></script>
</head>

<body wt="TargetController"  console-selector=".message_log"
		wh-c=".ConsoleCommand>TestConsole.OnConsoleCommand,
			  .contextmenu>InfoPanel.OnInfoClick,
			  Window.hashchange>InfoPanel.OnHashChange,
			  .click>DomHighlighter.OnClick"
	    wh-b="Target.click>TargetController.OnTargetClick,
			 .mouseover>HoverHelper.OnMouseOver,
			 .mouseout>HoverHelper.OnMouseOut">
	<div class="debug_wrapper"
			wh-b="ScreenWrapper.ScreenChange|!Dialog.Create|!Dialog.Destroy|!Screen.Create|!Screen.Destroy>TutorialHelper.OnScreenChange">
		<!-- Debug stuff here. -->
		<div class="debug_panel"><span class="tutorial_button" compendium="tutorial.tutorial/title2">👩‍🏫</span><span class="screen" screen-label></span></div>
		<div class="info_panel_widget">
			<div class="info_panel_contents"></div>
		</div>
		<div class="console_widget"></div>

		<!-- Main screen here. -->
		<div class="main_screen" wt="MainScreen ScreenWrapper" woof-queue="info.main_screen > [wt='EffectQueue']">
			<info class="main_screen" wh-b="Effect.Create|Effect.Destroy|Effect.Attr:pending-operation>GameEffectInvoker.OnNewElement,
				                            HandlerOwner.Destroy>HandlerSet.onRemoveOwner">
				<effects wt="EffectQueue">
					<handlers default="GameEffectImpls.HandleDefault">
						<!-- Handlers for round structure -->
						<handler-set label="Overall game structure">
							<handler handler="GameRules.NewRun" event-types="Run"></handler>
							<handler handler="GameRules.NewDay" event-types="NewDay"></handler>
							<handler handler="GameRules.ExecuteDay" event-types="ExecuteDay"></handler>
							<handler handler="EventRules.Event" event-types="Event"></handler>
							<handler handler="EventRules.Vignette" event-types="Vignette"></handler>
							<handler handler="EncounterRules.Encounter" event-types="Encounter"></handler>
						</handler-set>

						<!-- Handlers for updating functional UI -->
						<handler label="TargetPicker" handler="TargetPicker.PickTarget" event-types="PickTarget"></handler>

						<!-- Common handlers for resetting RNG -->
						<handler-set label="RNG Resetters">
							<handler label="ResetRNG-Day" handler="ASRNG.__invalidateHandler" event-types="NewDay:after" counter="day"></handler>
							<handler label="ResetRNG-Event" handler="ASRNG.__invalidateHandler" event-types="Event:after" counter="event"></handler>
							<handler label="ResetRNG-Round" handler="ASRNG.__invalidateHandler" event-types="Round:after" counter="round"></handler>
							<handler label="ResetRNG-EncounterAfterEncounter" handler="ASRNG.__invalidateHandler" event-types="Encounter:after" counter="encounter"></handler>
							<handler label="ResetRNG-EncounterAfterVignette" handler="ASRNG.__invalidateHandler" event-types="Vignette:after" counter="encounter"></handler>
						</handler-set>
					</handlers>

					<queue wh-c=".AddChild|.RemoveChild>GameEffect.OnChildChange">
					</queue>
				</effects>
			</info>

		</div>
	</div>
	
	<!-- Temporary holding cell for screens not in use. -->
	<div wt="ScreenHolder" class="holding_area" purpose="hidden">
	
	</div>	
	<!-- Holding cell for where we keep game data (not state) -->
	<compendium>

		<concept hash="events">
			<info-panel>
				<h2>Events</h2>
				<p>Events are the implementation of assignments.  Basically:<ul>
					<li>A rumor becomes an assignment</li>
					<li>An assignment in progress is an event</li>
				</ul></p>
				<p>Events are basically like state machines.</p>

				
			</info-panel>		
		</concept>

		<concept hash="encounter">
			<info-panel>
				<h2>Encounters</h2>
				<p>Encounters are combat.  I don't want to rename them all though.</p>
			</info-panel>

			<!-- Default encounter setup scripts. -->



		</concept>
		
		<concept hash="assignments">
			<info-panel renderer="Compendiums.RenderAssignment">
				<h2>Assignments</h2>

				<p>Assignments are basically quests.  I dunno why I didn't just call them that in the first place.</p>
				<p>You send units on these when you embark, and you may get <span compendium="concept/assignments/concept/results">rewards</span> when you return.</p>

				<template>
					<p>Right-click <span compendium="concept/assignments">here for the base page on assignments</span></p>
					<div class="compendium_view">

					</div>
				</template>
			</info-panel>

			<concept hash="results">
				<info-panel>
					<h2>Assignment Results</h2>
					<p>Possible results from an adventure thing are money and healing.  More to come!</p>
				</info-panel>
			</concept>
			
			<concept hash="cost">
				<info-panel>
					<h2>Rumor Costs</h2>
					<p>Some rumors cost money to buy.  If it's a flat cost, it's just listed.  If it's per-unit, there's a face added to it.</p>
					<p>If the button is greyed out, you don't meet the requirements.  For example, medical help requires units that are missing HP.</p>
				</info-panel>
			</concept>

			<!-- Left as an example.  Ideally this would be propulated based on your save state. -->
			<starting-rumors>
				<!-- <assignment bp="lost_city"></assignment> -->
				<assignment bp="hunt_for_food"></assignment>
			</starting-rumors>

			<result-handlers>
				<!-- In priority order! -->
				<result-handler type="add-gold" fn="GameRules.AddGoldResult"></result-handler>
				<result-handler type="add-rumor" fn="GameRules.AddRumorResult"></result-handler>
				<result-handler type="heal-units" fn="GameRules.HealUnitsResult"></result-handler>
			</result-handlers>

			<default-assignment assignment-invoke-fn="GameRules.LaunchEvent"></default-assignment>

			<assignment-blueprint name="hunt_for_food">
				<info label="Hunt for food"></info>
				<event bp="enc.hunt_for_food"></event>
				<assign max-units="5" require="false" req-label="Up to 5 units"></assign>
			</assignment-blueprint>

			<assignment-blueprint name="hangingout">
				<config></config>
				<info assignment-invoke-fn="GameRules.LaunchEffect"></info>
				<info encounter-fn="Events.success"></info>
				<info default-for-units="true"></info>
				<info label="Hang Around Base"></info>
				<info wt="Hint">This is what units do by default.  You probably have better choices!</info>
				<assign required="false" req-label="Each unit finds 1 gold and heals 5 HP"></assign>
				<result>
					<add-gold amount-fn="Events.hangOutGold" amount="1+"></add-gold>
 				</result>
				<result>
					<heal-units amount="5"></heal-units>
				</result>
			</assignment-blueprint>
		</concept>

		<concept hash="unit">

			<info-panel renderer="Compendiums.RenderUnit">
				<h2>Unit</h2>

				<p>Units are the folks who bash eachother until they stop moving.  Your units are either on the field (on a grid) or stuck in a <span compendium="concept/cards">card</span>.</p>
				<p>You play units from cards onto the battlefield.  When units retreat, they return to your <span compendium="concept/cards/concept/discard">discard pile</span>.</p>
				<p>Units have Hit Points, represented by a bar below them.  When this bar is empty, the unit is dead: gone forever!</p>
				<p>Player units have Birthdays, represented by the other icons in their avatar bubble.  These determine how the units <span compendium="concept/unit/concept/combo">combo</span> together.</p>

				<template>
					<h2>Unit Details</h2>
					<p>Right click <span compendium="concept/unit">here for the main page on units in general.</span></p>
					<div class="exploded_cards" facing="up">
						<div class="card unit_container">

						</div>
					</div>
				</template>				
			</info-panel>

			<concept hash="block">
				<info-panel>
					<h2>Block and Vulnerability</h2>

					<p>A unit with a 🛡️ next to their HP bar with a number in it has Block.  When receiving attack damage, Block is spent before HP is.</p>
					<p>Sometimes a unit may have a 💥 next to their HP instead.  This unit is Vulnerable, and any attack damage they take will be increased by this amount.</p>
					<p>Vulnerability can be directly reduced by gaining block.  For example, a unit with 5💥 will have 3🛡️ if they gained 8 block.</p>
					<p>Block does not stack; the largest source of block will overwrite smaller sources of block.</p>
					
				</info-panel>
			</concept>

			<concept hash="taunt">
				<info-panel>
					<h2>Taunt</h2>

					<p>A unit with a 🎯 next to their avatar is taunted.</p>
					<p>Taunted enemies are prioritized by your units for attack, if possible.</p>
					<p>Only one unit for a given team may be taunted in a given cell block.</p>
					<p>New taunts take priority.  Old taunts are stored and are restored if the currently-taunted unit loses their taunt status.</p>
				</info-panel>
			</concept>


			<concept hash="combo">
				<info-panel>
					<h2>Combo</h2>

					<p>When 2 or more units Combo, they use their <span compendium="concept/skills">skills</span> as normal, but they will be powered up by each other.</p>
					<p>2 units can combo if one more more of the following is true: <ul>
						<li>They have the same birth month (🔥🌪️💧⛰️)</li>
						<li>They have the same or adjacent birth days (🌕🌖🌗🌘🌑🌒🌓🌔)</li>
					</ul>
					Units that can't normally combo together can if there's a unit to act as social glue.</p>

					<p>Units can only combo if they are using moves in the same volley.  In other words, look for moves that have the same cooldown!</p>

					<p style="font-style: italic;">For example, 🔥🌕 and 💧🌑 can combo together if 🔥🌑 is there to help!</p>
				</info-panel>

			</concept>


			<concept hash="activation">
				<info-panel>
					<h2>Activation</h2>

					<p>A unit is activated whenever it could possibly act, regardless of whether it is in a valid position for a given ability.</p>
					<p>The skill for an activation only occurs if the unit is in the right <span compendium="concept/position">position</span> or if close-quarters combat conditions are met.</p>
					<p>Units may have up to 5 possible activations.  Activations have a cooldown.  Once an activation cooldown reaches 1, the unit will use that ability on their next volley.</p>
					<p>If a unit has multiple activations with a cooldown of 1, the left-most one will be activated.</p>
					<p>Under certain situations, units that activate together may <span compendium="concept/unit/concept/combo">combo</span>.</p>
					<p></p>
				</info-panel>
			</concept>
		</concept>

		<concept hash="status">
			<info-panel>
				<h2>Status</h2>

				<p>Units can have statuses, which are represented above their avatar on the battlefield.</p>
				
				<p>At the time of writing, the following statuses exist: <ul>
					<li>🏳️: This unit will retreat once this reaches 0.  A retreated unit returns to your discard pile if it's yours, or simply leaves the battlefield if it's an enemy unit.</li>
					<li>💨: This unit is moving, but was unable to move last time it tried.  Each stack can help the unit move further on a single activation.</li>
					<li>🩸: This unit will take this amount of damage (bypasses block) whenever it attempts to use an ability.  After taking damage, the number of of stacks will reduce to half its current value.</li>
					<li>💫: This unit cannot combo with other units.</li>
				</ul></p>
			</info-panel>


			<!-- Orders -->
			<status-blueprint type="retreat_order" exclusive="order" icon="" extra-classes="hidden" apply-fn="RetreatOrder.onApply" remove-fn="RetreatOrder.onRemove" merge-fn="RetreatOrder.merge"></status-blueprint>
			<status-blueprint type="reposition_order" exclusive="order" icon="" extra-classes="hidden" apply-fn="RepositionOrder.onApply" remove-fn="RepositionOrder.onRemove">
				<handler label="RepositionOrder" handler="RepositionOrder.OnAfterVolley" event-types="Volley:after"></handler>
			</status-blueprint>

			<!-- Statuses -->
			<status-blueprint type="defend" icon="" extra-classes="hidden" extra-types="Defend" merge-fn="DefendStatus.merge" stack-fn="DefendStatus.stack">
			</status-blueprint>

			<status-blueprint type="retreating" icon="🏳️" extra-class="" merge-fn="RetreatStatus.merge">
				<handler label="Retreating" handler="RetreatStatus.OnAfterVolley" event-types="Volley:after"></handler>
			</status-blueprint>

			<status-blueprint type="agility" icon="💨" extra-class="" merge-fn="AgilityStatus.merge">
				<handler label="Agility" handler="AgilityStatus.OnAfterVolley" event-types="Volley:after"></handler>
			</status-blueprint>

			<status-blueprint type="bleed" icon="🩸" extra-class="" merge-fn="BleedStatus.merge">
				<handler label="Bleed" handler="BleedStatus.OnAfterUseAbility" event-types="UseAbility:after"></handler>
			</status-blueprint>

			<status-blueprint type="distracted" icon="💫" extra-class="" merge-fn="DistractedStatus.merge" remove-fn="DistractedStatus.onRemove" apply-fn="DistractedStatus.onApply">
				<handler label="Distracted" handler="DistractedStatus.TickDownMaybe" event-types="UseAbility:after"></handler>
			</status-blueprint>

			<status-blueprint type="base_damage" icon="💪" extra-class="" merge-fn="BaseDamageStatus.merge" stack-fn="BaseDamageStatus.onStackChange" remove-at-zero="true">
			</status-blueprint>

			<status-blueprint type="base_defense" icon="🛡️" extra-class="" merge-fn="BaseDefenseStatus.merge" stack-fn="BaseDefenseStatus.onStackChange" remove-at-zero="true">
			</status-blueprint>

			<!-- Enemy AI / etc -->
			<status-blueprint type="rat_ai" exclusive="ai" icon="" extra-classes="hidden">
				<handler label="DecideTargetLocation" handler="RatAI.OnAfterVolley" event-types="Volley:after"></handler>
			</status-blueprint>
			<status-blueprint type="jimmy_ai" exclusive="ai" icon="" extra-classes="hidden">
				<handler label="DoJimmyThings" handler="JimmyAI.OnAfterVolley" event-types="Volley:after"></handler>
			</status-blueprint>
			<status-blueprint type="jimmy_blessing" icon="🤴" extra-classes="" apply-fn="JimmyBlessing.onApply" remove-fn="JimmyBlessing.onRemove" >
			</status-blueprint>

			<status-blueprint type="bug_curl_up" icon="➰">
				<handler label="AfterDamage" handler="BugEnemy.CurlUpAfterHit" event-types="TakeDamage:after"></handler> 
			</status-blueprint>
			<status-blueprint type="web_damage_reduction" icon="🕸️">
				<handler label="BeforeDamage" handler="WebObstacle.BeforeDamage" event-types="TakeDamage:before"></handler> 
			</status-blueprint>

			<!-- Some generic enemy AIs -->
			<status-blueprint type="basic_ai" exclusive="ai" icon="" extra-classes="hidden">
				<handler label="DecideTargetLocation" handler="BasicAI.OnAfterVolley" event-types="Volley:after"></handler>
			</status-blueprint>

		</concept>

		<concept hash="position">
			<info-panel>
				<h2>Position</h2>

				<p>The position of a unit determines what <span compendium="concept/skills">skills</span> will <span compendium="concept/unit/concept/activation">activate</span>.</p>
				<p>A unit's effective position (front, middle, back) is based on a combination of its literal position and the direction the squad is facing.</p>
				<p style="font-style: italic;">For example, a unit facing up in the top row is in the front row.  If the squad then faces down, the unit is now in the back row.</p>
				<p>Some abilities indicate activity on their directional arrow.  This implies the ability is active if there are enemy units in the unit's block, or if the unit is in an enemy block.</p>
			</info-panel>
		</concept>

		<concept hash="round">
			<info-panel>
				<h2>Round</h2>

				<p>A round begins once you push the big play button.  A round will continue until the combat ends, or you click the button again to stop the action.</p>
				<p>The top number in the ⌛ indicates how many <span compendium="concept/volley">volleys</span> must occur before you can end the round.  You can still click the button to experience the combat one volley at a time, but the round will not end until this timer reaches 0.  Once it reaches 0, you will also draw a card.</p>
				<p>The bottom number in the ⌛ indicates how many <span compendium="concept/volley">volleys</span> over the minimum have occurred.  This doesn't do anything yet, but I'm hoping to add a Push-your-luck sort of feature to the game around this.</p>
			</info-panel>
		</concept>

		<concept hash="volley">
			<info-panel>
				<h2>Volley</h2>

				<p>A single <span compendium="concept/round">round</span> is broken into a number of volleys.</p>
				<p>During a volley, any unit actions that can be triggered (e.g. due to positioning) with a cooldown value of 1 or less will happen.</p>
			</info-panel>
		</concept>
		

		<concept hash="features">
			<info-panel>
				<h2>Future Features</h2>

				<ul>
					<li>Preparation Cards: Costs money to play, but provide immediate benefits for the unit/squad.</li>
					<li>Unit Promotions: Allows you to add new activations/skills to units, along with passive abilities.</li>
					<li>Skill Upgrades: Allows you to add special combo-powers to skills.</li>
					<li>Outer Loop: A single run will be 1 year, cycling through 32 days, with a boss fight after each 8th day.</li>
				</ul>

			</info-panel>
		</concept>


	</compendium>	

	<!-- Put them all in one place to hide them. -->
	<div class="templates">

		<template name="event_global_state">
			<event-state wt="EventState"></event-state>
		</template>

		<template name="modal_dialog">
			<div class="modal_screen modal_dialog"></div>
		</template>

		<template name="unit_select_screen">
			<div wt="Dialog" class="unit_select dialog EXTRA_CLASSES" minimum_units="MINIMUM_UNITS" maximum_units="MAXIMUM_UNITS"
			    wh-c="Accept.click>UnitSelect.Accept,
					  Cancel.click>UnitSelect.Cancel,
					  Card.Attr:selected>UnitSelect.OnSelected,
					  Card.mouseover>UnitSelect.OnHover"
				wh-b="Card.click>Card.ToggleSelected">
				<div class="header"><span class="first"></span></div>
				<div class="option_header">Select Cards</div>
				<div class="option_holder stumpy_cards"></div>
				<div class="unit_preview exploded_cards" facing="up"></div>
				<div class="selected_header">Selected Cards</div>
				<div class="selected_holder stumpy_cards"></div>
				<div class="button_holder">
					<div class="info">Select between MINIMUM_UNITS and MAXIMUM_UNITS units!</div>
					<button wt="Accept">Accept</button>
					<button wt="Cancel">Cancel</button>
				</div>

			</div>
		</template>

		<template name="manage_items_dialog">
			<div wt="Dialog" class="manage_items dialog EXTRA_CLASS"
			screen-label="Manage Items" tutorial-label="tutorial.tutorial/manageitems"
			    wh-c="Okay.click>ManageItemsDialog.Accept,
					  EmptyAll.click>ManageItemsDialog.EmptyAll"
				wh-b="Card.click>ManageItemsDialog.CardClicked,
					  Item.click>ManageItemsDialog.ItemClicked">
				<div class="header"><span class="first"></span></div>
				<div class="storage_header"></div>
				<div class="storage_holder stumpy_cards"></div>
				<div class="units_holder stumpy_cards"></div>
				<div class="unit_preview exploded_cards" facing="up"></div>
				<div class="button_holder">
					<button wt="EmptyAll">Empty All Units</button>
					<button wt="Okay">Done</button>
				</div>
			</div>
		</template>
		
		<template name="shop_dialog">
			<div wt="Dialog" class="shop_dialog dialog EXTRA_CLASS"
			screen-label="Shop" tutorial-label="tutorial.tutorial/shop"
			    wh-c="Okay.click>ShopDialog.Done"
				wh-b="Card.click>ShopDialog.ShopItemClick,
					  Tab.click>ShopDialog.TabClicked">				
				<div class="header"><span class="appearance_holder"></span><span class="name_holder"></span><span class="quote_holder"></span></div>				
				<div class="inventory_header"></div>
				<div class="inventory_holder stumpy_cards"></div>

				<div class="tab_controls">
					<div wt="Tab" mode-class="view_storage" class="unit_tab"></div>
					<div wt="Tab" mode-class="view_units" class="unit_tab"></div>
				</div>

				<!-- Tab 1: Looking at storage. -->
				<div class="storage_header"></div>
				<div class="storage_holder stumpy_cards"></div>

				<!-- Tab 2: Looking at units.  -->
				<div class="units_holder stumpy_cards"></div>
				<div class="unit_preview exploded_cards" facing="up"></div>

				<div class="button_holder">
					<button wt="Okay">Done</button>
				</div>
			</div>
		</template>

		<template name="shop_item">
			<div class="shop_item"wt="ShopItem">		
				<div class="card_holder"></div>		
				<div class="price_holder"></div>
			</div>
		</template>

		<template name="embark_dialog">
			<div wt="Dialog" class="embark_dialog dialog EXTRA_CLASS"
					screen-label="Embark" tutorial-label="tutorial.tutorial/embark"
					wh-c="Okay.click>EmbarkDialog.Accept,
						  Cancel.click>EmbarkDialog.Cancel,
						  Reset.click>EmbarkDialog.Reset"
		  			wh-b="Card.click>EmbarkDialog.ClickCard,
					  	  AddUnit.click>EmbarkDialog.ClickAddUnit">
				<div class="header"></div>
				<div class="units_holder stumpy_cards">
				</div>
				<div class="assignment_holder stumpy_cards"></div>
				<div class="button_holder">
					<button wt="Reset">Reset Assignments</button>
					<button wt="Cancel">Wait, go back to town</button>
					<button wt="Okay">Embark!</button><span class="pending_cost" cost="0"></span>
				</div>
			</div>
		</template>		
		
		<template name="title_screen">
			<div class="title_screen modal_screen" wt="Screen TitleScreen" screen-label="Title Screen" tutorial-label="tutorial.tutorial/title2">
				<h1> JSOBP Prototype</h1>

				Welcome to the JSOBP prototype!

				<p>Right click on things you want to learn more about.  Many of them have mini-wiki pages, which will show up on the panel to the right.</p>
				<p style="background: rgba(0, 0, 255, 0.5); font-weight: bolder;"><span compendium="tutorial/title">Right-Click Here if you don't know how to play and look to the panel in the upper-right of your screen!</span></p>

				<br />

				<p><button class="start_button" wt="StartButton" wh-c="StartButton.click>TitleScreen.OnStart">Start!</button></p>
				<p><input class="seed_input" type="text" placeholder="Seed (in progress!)"></input></p>

				<div>
					<span>Version History</span>
					<ul>
						<li><span compendium="version_history.version/0.0.1">V0.0.1</span></li>
						<li><span compendium="version_history.version/0.0.2">V0.0.2</span></li>
						<li><span compendium="version_history.version/0.0.3">V0.0.3</span></li>
						<li><span compendium="version_history.version/0.0.4">V0.0.4</span>  <span compendium="version_history.version/0.0.4.1">V0.0.4.1</span></li>
						<li><span compendium="version_history.version/0.0.5">V0.0.5</span> <span compendium="version_history.version/0.0.5.1">V0.0.5.1</span> <span compendium="version_history.version/0.0.5.2">V0.0.5.2</span> <span compendium="version_history.version/0.0.5.3">V0.0.5.3</span> <span compendium="version_history.version/0.0.5.4">V0.0.5.4</span>  <span compendium="version_history.version/0.0.5.5">V0.0.5.5</span> <span compendium="version_history.version/0.0.5.6">V0.0.5.6</span> <span compendium="version_history.version/0.0.5.7">V0.0.5.7</span> <span compendium="version_history.version/0.0.5.8">V0.0.5.8</span></li>
						<li><span compendium="version_history.version/0.0.6">V0.0.6</span> <span compendium="version_history.version/0.0.6.1">V0.0.6.1</span> <span compendium="version_history.version/0.0.6.2">V0.0.6.2</span></li>
						<li><span compendium="version_history.version/0.0.7">V0.0.7</span></li>
					</ul>
				</div>
			</div>
		</template>

		
		<template name="run_screen">
			<div class="run_screen modal_screen" wt="Screen RunScreen" screen-label="New Run"
					ds-scope-name="run" ds-scope-data="{}"
					wh-c="RunInfo.Attr>RunScreen.OnRunInfoChange">
				<info>
					<noise-counters>

					</noise-counters>
				</info>
				<div class="run_bar_container"></div>
				<div class="body_container" wt="ScreenWrapper">
					<div wt="PlaceholderScreen Screen"></div>
				</div>
			</div>
		</template>

		<template name="town_screen">
			<div class="town_screen modal_screen" wt="Screen TownScreen" screen-label="Town Screen" tutorial-label="tutorial.tutorial/townscreen"
			    wh-c="BuyRumor.click>TownScreen.BuyRumor,
					  StorageButton.click>TownScreen.ViewStorage,
					  GoShopping.click>TownScreen.GoShopping,
					  Go.click>TownScreen.OnEmbark"
				wh-b="AssignmentHolder.AddChild|AssignmentHolder.RemoveChild>TownScreen.RefreshEmbark">
				<h2>Town</h2>

				<p>Welcome to your town screen.  You can talk to visitors to buy supplies, and you can assign units to rumors to send them on adventures.</p>

				<div class="facility_holder">
					<div class="buttons">
						<button wt="StorageButton">Manage Items</button>
						<button wt="TacticsButton" disabled="true">Manage Tactics <br />(Coming Soon)</button>
					</div>
				</div>


				<div class="visitor_holder"></div>
				
				<div class="rumor_holder">
				</div>

				<div class="assignment_group">
					<div wt="AssignmentHolder" class="assignment_holder">

					</div>
					<div class="button_holder">
						<button class="embark_button" wt="Go">Embark!</button>
					</div>
				</div>
			</div>
		</template>

		<template name="town_visitor">
			<div wt="Visitor" class="town_visitor" compendium="concept/visitor">
				<div class="appearance">
					<div class="month" month="MONTH"></div>
					<div class="day" day="DAY"></div>
					<div class="avatar" appearance="AVATAR"></div>
				</div>
				<div class="name" name="NAME"></div>
				<info wt="VisitorBP"></info>
				<div class="shopping">
					<button wt="GoShopping" class="shopping_button"></button>
					<inventory></inventory>
					<refill></refill>
					<info wt="BP"></info>
				</div>
			</div>
		</template>

		<!-- Structure of a rumor -->
		<template name="town_rumor">
			<div class="town_rumor" wt="Rumor">
				<span class="name" label="NAME"></span>
				<span class="results" compendium="concept/assignments/concept/results"></span>
				<span class="button_container">
					<button wt="BuyRumor" compendium="concept/assignments/concept/cost">
						<span class="cost_appearance" min-cost max-cost bounded></span>
					</button>
				</span>
				<info wt="BP">

				</info>
			</div>
		</template>

		<!-- Structure of an assignent.  -->
		<template name="town_assignment">
			<div class="town_assignment" wt="Assignment" pending-cost="0" compendium="concept/assignments"  compendium-hash-fn="WoofType.buildSelectorFor">
				<div class="quest_text">
					<div class="quest_name" label="NAME"></div>
					<div class="quest_restrictions" req-label=""></div>
				</div>
				<div class="quest_giver"></div>
				<div class="rewards" compendium="concept/assignments/concept/results"></div>
				<div class="populate_units stumpy_cards">
					<div wt="AddUnit" class="add_unit_button"></div>
				</div>
				<info wt="BP AssignmentBP"></info>
			</div>
		</template>

		<!-- Structure of an Event wrapper -->
		<template name="event_screen">
			<div wt="Screen EventScreen" screen-label="LABEL"
					ds-scope-name="event" ds-scope-data="{}"
					class="event_screen">
				<!-- Place to dump a copy of the event blueprint. -->
				<blueprint></blueprint>
				<!-- Place to dump additional results. -->
				<results></results>
				<!-- Place to dump units -->
				<units></units>
				<!-- Place to dump cards-->
				<deck></deck>
				<div wt="ScreenWrapper">
				</div>
			</div>
		</template>
		
		<!-- Structure of an vignette -->
		<template name="vignette_screen">
			<div class="vignette_screen" wt="Screen VignetteScreen" screen-label="Vignette" tutorial-label="tutorial.tutorial/vignette"
					wh-b="Choice.click>EventRules.PickChoice">
				<div class="story">
					<div class="title"></div>
					<div class="micro_cards units"></div>
					<div class="flavor"></div>
				</div>
				<div class="choices"></div>
			</div>
		</template>
		
		<!-- Structure of a vignette choice. -->
		<template name="vignette_choice">
			<div><button wt="Choice" choice="CHOICE_ID" class="vignette_choice">LABEL</button></div>
		</template>

		<!-- Structure of a combat encounter -->
		<template name="encounter_screen">
			<div  wt="Screen EncounterScreen" screen-label="Encounter Screen" tutorial-label="tutorial.tutorial/encounterscreen" class="encounter_screen modal_screen"
														wh-c="Card.Attr:selected>CardRules.OnCardSelected,
															  Battlefield.NewUnit>EncounterRules.OnUnitsChanged|Unit.OnUnit,
															  Battlefield.RemovedUnit>EncounterRules.OnUnitsChanged|Unit.onUnitRemoved,
															  Battlefield.UnitMoved>Unit.OnUnit,
															  Unit.Attr:taunt-list>Unit.OnTauntListChange,
															  ActionButton.giveup>EncounterRules.OnGiveUp,
															  ActionButton.go>EncounterRules.OnGo,
															  ActionButton.stop>EncounterRules.OnStop,
															  ActionButton.cancel>EncounterRules.OnCancel,
															  ActionButton.Attr:pending-action>EncounterRules.OnActionButtonPendingAction,
															  CellBlock.Attr:facing>EncounterScreenHandler.OnCellBlockFacingChange|Unit.OnCellBlockFacingChange|Grid.OnCellBlockFacingChange,
															  CellBlock.mouseover>EncounterScreenHandler.OnCellBlockMouseOver,
															  CellBlock.Attr:taunt-priority>Unit.OnTauntPriorityChange,
															  DrawPileUi.click>CardRules.OnDrawPileClick,
															  Unit.Attr:in-block>Unit.onMoveBlock|BattlefieldHandler.onMoveBlock"
														wh-b="GhostUnit.click>EncounterRules.OnGhostUnitClick"														
														max-player-units="5"
														initiative-order="player enemy neutral"
				<!-- Info for battlefield things -->
				<info class="encounter" wt="EncounterBP">
					
				</info>
				<div class="battlefield_widget_container"></div>
				<div class="preview_panel"></div>
				<div class="tldr_panel"></div>
				<div wt="EndConditions" class="end_condition_container"></div>
				<div class="action_button" wt="ActionButton" mode="" wh-c=".click>ActionButton.OnClick">
				</div>
				<div class="volley_tracker" compendium="concept/round"
						wh-b="SpeedButton.click>VolleyCounter.OnSpeedButtonClick,
							  PlayPauseButton.click>VolleyCounter.OnPlayPauseClick|EncounterRules.OnResume,
							  StepButton.click>VolleyCounter.OnStepClick|EncounterRules.OnStep">
					<div wt="StepButton" class="step_button"></div>
					<div wt="PlayPauseButton" class="play_pause_button" options="pause play" current_option="pause"></div>
					<div wt="SpeedButton" class="speed_button" speed_options="1 2 0" current_speed="1"  compendium="ui.uihelp/encounter/uihelp/speedbutton"></div>
					<div class="countdown" minimum-volleys="8" volleys-left="8"></div>
					<div class="countup" volleys-over-min></div>
				</div>
				<div wt="BannerEffect" class="text_banner_effect"></div>
				<div wt="CardHud" class="card_hud_widget full_size_cards" wh-c="CardSet.AddChild|CardSet.RemoveChild|CardSet.MoveFrom|CardSet.MoveTo>CardHud.OnContentChange"></div>
			</div>
		</template>
		
		<!-- Battlefield Root -->
		<template name="battlefield">
			<div wt="Battlefield" class="battlefield_widget" effect-container=":scope > .ui_effect_overlay"
					wh-b=".Attr:smol-x|.Attr:smol-y|.Attr:beeg-x|.Attr:beeg-y>BattlefieldHandler.OnOverlayItemMove,
						  BattleOverlay.AddChild>BattlefieldHandler.OnOverlayItemAdd,
						  BattleOverlay.RemoveChild>BattlefieldHandler.OnOverlayItemRemove,
						  BattleOverlay.MoveTo>BattlefieldHandler.OnOverlayItemMoveTo,
						  CellBlock.Attr:team|BattleOverlay.RemoveChild|.Attr:beeg-x|.Attr:beeg-y>BattlefieldHandler.refreshThreat">
				<div wt="Grid" class="battlefield_widget_inner"></div>
				<div wt="BattleOverlay" class="battlefield_widget_overlay"></div>
				<div class="ui_effect_overlay"></div>
			</div>
		</template>
				
		<!-- Structure of our card HUD -->
		<template name="card_hud">
			<div wt="DrawPileUi" class="deck" compendium="concept/cards/concept/drawpile">
			  <div wt="CardSet DrawPile" class="content" team-id="Player"></div>
			  <div class="size"></div>
			</div>
			<div class="discard"  compendium="concept/cards/concept/discard">
			  <div wt="CardSet Discard" class="content" team-id="Player"></div>
			  <div class="size"></div>
			</div>
			<div wt="HandRules" class="hand" at-least="5" at-most="10" wh-c=".click>CardHud.OnCardSelect">
			  <div wt="CardSet Hand" class="content" team-id="Player"></div>
			  <div class="size"></div>
			</div>
			<div wt="CardPurgatory" class="purgatory"></div>
		</template>
		
		<!-- Structure of a card -->
		<template name="card">
			<div wt="Card" class="card" compendium="concept/cards/concept/card" w-id="ID">			
			</div>
		</template>

		<template name="token">
			<div wt="Token" class="token" compendium="concept/token" w-id="ID">			
			</div>
		</template>
		
		<template name="tactic">
			<div class="tactic" card-type="tactic" target-fn="TARGET_FN" invoke-fn="INVOKE_FN">
				<div class="card_bubble" card-icon="CARD_ICON" compendium="concept/tactics"><div tactic-type="TACTIC_SHORTLABEL"></div></div>
				<div class="name">TACTIC_LABEL</div>
				<div class="description">TACTIC_DESCRIPTION</div>
			</div>
		</template>

		<template name="combo">
			<div class="combo_card" wt="Combo" card-type="combo" compendium="concept/combos" compendium-hash-fn="WoofType.buildSelectorFor">
				<div class="appearance">
					<div class="cooldown" cooldown="9000" reset-cooldown="9000"></div>
				</div>
				<div class="name" label="Combo name here!"></div>
				<div class="recipe"></div>
				<div class="description"></div>

				<info wt="BP"></info>
			</div>
		</template>

		<template name="preparation">
			<div class="preparation" wt="Item" name="NAME" card-type="preparation" target-fn="TARGET_FN" invoke-fn="INVOKE_FN" compendium="concept/preparations" compendium-hash-fn="WoofType.buildSelectorFor">
				<div class="appearance APPEARANCE_CLASS" appearance-1="APPEARANCE_1" appearance-2="APPEARANCE_2">
					<div class="cost" cost="COST"></div>
				</div> 
				<div class="name" label="LABEL"></div>
				<div class="uses" uses="USES"></div>
				<div class="description">DESCRIPTION</div>
				<info wt="BP"></info>
			</div>
		</template>

		<template name="preparation_use">
			<span class="use"></span>
		</template>
		
		<!-- Unit -->
		<template name="unit">
			<div class="battlefield_unit" wt="Unit" card-type="unit" w-id="UNIT_ID" highlight-scroll-to="true" compendium="concept/unit" compendium-hash-fn="WoofType.buildSelectorFor"
					target-fn="UnitRules.TargetUnitPlacement" invoke-fn="UnitRules.InvokeUnitPlacement"
					wh-c="
					    Ability.Updated>Unit.OnUnit,
						Ability.AddChild>Ability.HoverHelpRefresh,
						Unit.Attr:month|Unit.Attr:day|Unit.Attr:avatar>Unit.RefreshAppearance"
					month="" day="" appearance="" mana="" mana-fn="Mana.DefaultMana" hover-help="[hover-on-unit='UNIT_ID']" stopped="true">
				<div class="appearance no_transition">
					<div class="month" month=""></div>
					<div class="day" day=""><span></span></div>
					<div class="avatar" appearance=""></div>
				</div>
				<div class="name" name=""></div>
				<div class="help_taunt"><div class="decor"></div></div>
				<div class="hurt_taunt"><div class="decor"></div></div>
				<div class="hp_tracker">
					<progress class="hp_bar" wt="HPBar" max="0" value="0"> </progress>
					<div class="defend"><div class="decor"></div></div>
				</div>

				<!-- Goal and AI tracker -->
				<div class="goal_tracker">
				</div>

				<!-- Base is copied into non-base during combat. -->
				<div class="battle_script_base"></div>
				<div class="battle_script">
					<div class="cooldown_view"></div>
					<div class="next_icon_view"></div>
				</div>

				<div class="unit_status"></div>

				<inventory max-items="2"></inventory>
				<combos max-items="2"></combos>
				<info wt="UnitBP"></info>
				<info wt="ModBP"></info>
		</div>
		</template>

		<template name="move_slot">
			<div class="move_slot" wt="MoveSlot"
					wh-c="Move.Attr:inactive>MoveSlot.OnMoveActiveChange" inactive="true">
				<div class="appearance">
					<div class="name" moveset_name="Unarmed"></div>
					<div class="description"></div>
				</div>

				<!-- The moves go here. -->
				<div class="move_container"></div>

				<!-- Timing Info -->
				<div class="current_cooldown" current-cooldown="8"></div>
				<div class="cooldown_duration" cooldown-duration="8"></div>
				<div class="warmup" warmup-time="8"></div>
			</div>

		</template>

		<template name="move">
			<!-- These hang out in move slots. -->
			<div class="move" wt="Move" compendium="concept/skills" priority="0" inactive="false">
				<div class="appearance_holder" move_icon="❓"></div>
				<info wt="MoveBP"><!-- Blueprint goes here!--></info>
			</div>
		</template>

		<template name="unit_status">
			<div wt="Status" class="status STATUS_CLASS" status_type="STATUS_TYPE"
					wh-c="Status.Attr:stack_count>BaseStatus.OnStackCountChange">
				<div class="status_icon" status_icon="STATUS_ICON"></div>
				<div class="stack_count" stack_count="0"></div>
				<info wt="BP"></info>
			</div>
		</template>
		
		<template name="run_bar">
			<div class="run_bar">
				Day: <div class="day_cycle" month="MONTH" day="DAY"></div>
				<div class="gold_container">
					<span class="icon_before" icon="🟡" current-gold="GOLD"></span>
				</div>
			</div>
		</template>

		<template name="run_info">
			<run-info seed="seeds_not_supported_yet">
				<!-- Where we track things for the run (like amount of gold, etc) -->
				<info wt="RunInfo" current-gold="0" day="🌖" month="⛰️"></info>
				<deck wh-c=".AddChild>Ability.HoverHelpRefresh">
					<!-- Where we store cards between encounters. -->

				</deck>
				<rumors>
					<!-- Where we jam available rumors that aren't associated with other visitors. -->
					
				</rumors>

				<visitors>					
					<!-- Where you jam visitors outside of known areas. -->

				</visitors>

				<storage>
					<!-- Where you jam items not in unit inventories. -->

				</storage>

				<units>

				</units>

				<graveyard>

				</graveyard>
				<workspace>
					<!-- Where I jam misc data about the run, like available names and appearance options. -->
				</workspace>
			</run-info>
		</template>
	</div>
	
	<!-- Trigger code at the bottom -->
	<script>

	require("woof/woof").then(function() {
		return Promise.all([
			requireAll(
				// Base libs.
				"woof/noise",
				"woof/ui",
				"woof/queue",
				"woof/domscript",
				"woof/goap",
				"controllers/savemanager",
				
				// Noise counters for RNG.
				"content/noisecounters",

				// Basic components.
				"ui/actionbutton",
				"ui/attrs",
				"ui/battlefield",
				"ui/encounterscreen",
				"ui/card",
				"ui/cardhud",
				"ui/compendiums",
				"ui/dialogscreen",
				"ui/effects",
				"ui/eventscreen",
				"ui/grids",
				"ui/hoverhelper",
				"ui/mainscreen",
				"ui/runbar",
				"ui/runinfo",
				"ui/runscreen",
				"ui/screen",
				"ui/titlescreen",
				"ui/townscreen",
				"ui/tutorialhelper",
				"ui/unit",
				"ui/move", // Uses UnitGen._rng in static initializer
				"ui/volleycounter",

				"ui/shared/unitselect",

				"ui/town/assignment",
				"ui/town/embarkscreen",
				"ui/town/manageitems",
				"ui/town/rumor",
				"ui/town/shopdialog",
				"ui/town/visitor",

				// Misc shit.
				// TODO: Try to get rid of this one.
				"controllers/cards",

				// Gameplay rules

				"rules/cardrules",
				"rules/encounterrules",
				"rules/eventrules",
				"rules/gamerules",
				"rules/targetpicker",
				"rules/unitrules",

				// Constants
				"content/constants",
				"content/teams",

				// Content
				"content/encounters",
				"content/enemies",
				"content/events",
				"content/goaps",
				"content/moves",
				"content/orders",
				"content/preparations",
				"content/skillutils",
				"content/statuses",
				"content/tactics",
				"content/units",
				"content/unitskills",
				"content/visitors",
				"ob"
			),
			loadDataFrames({
				// System templates.
				"woof": "data_frames/woof_templates.html",

				// Game stuff.
				"grid": "data_frames/grid.html",
				"ugen": "data_frames/phoenix/unit-gen.html",
				"moves": "data_frames/phoenix/moves.html",
				"enc": "data_frames/phoenix/encounters.html",
				"goap": "data_frames/phoenix/goap.html",

				// UI + Effects
				"ui": "data_frames/ui.html",
				"fx": "data_frames/fx.html",

				// Additional bullshit related to running the playtest.
				"version_history": "data_frames/version_history.html",
				"tutorial": "data_frames/tutorial.html"
			})
		]);
	}).then(function() {
		// Register our document root to be handled by the framework.
		WoofRootController.addRoot(document.body, [
		"hashchange"
		]);

		WoofRootController.__fixWindows();

		// Create a console widget where appropriate.
		var consoleContainerBoy = document.querySelector(".console_widget")
		TestConsole.create(consoleContainerBoy);
		TestConsole.focus(consoleContainerBoy);
				
		// Initialize our main screen handler.
		var mainScreen = document.getElementsByClassName("main_screen")[0];		

		// Navigate our info panel as needed.
		if (window.location.hash) {
			InfoPanel.navigateTo(document.body, window.location.hash.substring(1));
		}

		// Load the main UI.
		var titleScreen = TitleScreen.inflate();
		Screen.showScreen(document.body, titleScreen);
	});
	
	</script>

</body>

</html>