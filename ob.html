<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<title>JSOBP</title>

	<link rel="stylesheet" href="ob.css" />
	<style type="text/css"></style>
	<!-- Load code at the top -->
	<script src="woof/loader.js"></script>
</head>

<body wt="TargetController"  console-selector=".message_log"
		wh-c=".ConsoleCommand>TestConsole.OnConsoleCommand,
			  .contextmenu>InfoPanel.OnInfoClick,
			  Window.hashchange>InfoPanel.OnHashChange,
			  .click>DomHighlighter.OnClick"
	    wh-b="Target.click>TargetController.OnTargetClick,
			 .mouseover>HoverHelper.OnMouseOver,
			 .mouseout>HoverHelper.OnMouseOut">
	<div class="debug_wrapper"
			wh-b="ScreenWrapper.ScreenChange|!Dialog.Create|!Dialog.Destroy|!Screen.Create|!Screen.Destroy>TutorialHelper.OnScreenChange">
		<!-- Debug stuff here. -->
		<div class="debug_panel"><span class="tutorial_button" compendium="tutorial/title2">üë©‚Äçüè´</span><span class="screen" screen-label></span></div>
		<div class="info_panel_widget">
			<div class="info_panel_contents"></div>
		</div>
		<div class="console_widget"></div>

		<!-- Main screen here. -->
		<div class="main_screen" wt="MainScreen ScreenWrapper" woof-queue="info.main_screen > [wt='EffectQueue']">
			<info class="main_screen" wh-b="Effect.Create|Effect.Destroy|Effect.Attr:pending-operation>GameEffectInvoker.OnNewElement,
				                            HandlerOwner.Destroy>HandlerSet.onRemoveOwner">
				<effects wt="EffectQueue">
					<handlers default="GameEffectImpls.HandleDefault">
						<!-- Handlers for round structure -->
						<handler-set label="Overall game structure">
							<handler handler="GameRules.NewRun" event-types="Run"></handler>
							<handler handler="GameRules.NewDay" event-types="NewDay"></handler>
							<handler handler="GameRules.ExecuteDay" event-types="ExecuteDay"></handler>
							<handler handler="EventRules.Event" event-types="Event"></handler>
							<handler handler="EventRules.Vignette" event-types="Vignette"></handler>
							<handler handler="EncounterRules.Encounter" event-types="Encounter"></handler>
						</handler-set>

						<!-- Handlers for updating functional UI -->
						<handler label="TargetPicker" handler="TargetPicker.PickTarget" event-types="PickTarget"></handler>

						<!-- Common handlers for resetting RNG -->
						<handler-set label="RNG Resetters">
							<handler label="ResetRNG-Day" handler="ASRNG.__invalidateHandler" event-types="NewDay:after" counter="day"></handler>
							<handler label="ResetRNG-Event" handler="ASRNG.__invalidateHandler" event-types="Event:after" counter="event"></handler>
							<handler label="ResetRNG-Round" handler="ASRNG.__invalidateHandler" event-types="Round:after" counter="round"></handler>
							<handler label="ResetRNG-EncounterAfterEncounter" handler="ASRNG.__invalidateHandler" event-types="Encounter:after" counter="encounter"></handler>
							<handler label="ResetRNG-EncounterAfterVignette" handler="ASRNG.__invalidateHandler" event-types="Vignette:after" counter="encounter"></handler>
						</handler-set>
					</handlers>

					<queue wh-c=".AddChild|.RemoveChild>GameEffect.OnChildChange">
					</queue>
				</effects>
			</info>

		</div>
	</div>
	
	<!-- Temporary holding cell for screens not in use. -->
	<div wt="ScreenHolder" class="holding_area" purpose="hidden">
	
	</div>	
	<!-- Holding cell for where we keep game data (not state) -->
	<div class="compendium">

		<version hash="0.0.1">
			<info-panel>
				<h2>V0.0.1</h2>
				<p>Initial demo!  What works:</p>
				<ul>
					<li>Unit cards can be played.</li>
					<li>Initial Autobattling Structure</li>
					<li>Units have scripts that allow them to act during autobattling.</li>
					<li>Autobattling: <ul>
						<li>Volley Structure: 8 volleys that units can act on.</li>
						<li>Units act in block order.</li>
						<li>Team order within a volley is configurable (e.g. do enemies or allies go first)</li>
						<li>Units can combo when certain conditions are met.</li>
					</ul></li>
					<li>Unit Skills: Allow units to do things during autobattling. <ul>
						<li>"Strike" skill: Player units do 8 damage, Rats do 2.</li>
						<li>"Step" skill: Unit moves toward destination 1 square orthogonally.  If it can't, it gains 1 Agility instead (increases number of squares moved next time this is used).</li>
						<li>"Retreat" skill: Unit removes 1 stack of Retreat status.  Once it's 0, the unit returns to your discard pile.</li>
					</ul></li>					
					<li>"Order" cards: Instructs a unit with a short-term goal.  Override each other.<ul>
						<li>"Reposition": Instruct a unit to move to a given destination.  Temporarily overrides all skills to be "Step"</li>
						<li>"Retreat": Instruct a unit to return to your discard pile.  Temporarily overrides all skills to be "Retreat", grants 3 stacks of the "Retreat" status.</li>
					</ul></li>
					<li>Encounters:<ul>
						<li>"The Rats": 8 rats distributed between 2 blocks randomly.  Rats only use "Strike" for 2 damage each once per round.</li>
					</ul></li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.2">
			<info-panel>
				<h2>V0.0.2</h2>
				<p>Changes:</p>
				<ul>
					<li>Unit Skills:<ul>
						<li>"Push" skill: Pushes a unit back in the direction the acting unit is facing.  If there is another unit in the way, they collide with one another dealing damage.  The distance a unit is pushed is based on the attack strength of the pushing unit against the weight of the defending unit.</li>
						<li>"Defend" skill: Unit gains Defense, which is used to block damage from attacks and collisions.  This defense is lost at the end of a round.</li>
						<li>"Bleed" skill: Target enemy gains the Bleed status based on 75% of the unit's attack damage.</li>
					</ul></li>
					<li>Player Units:<ul>
						<li>Units with üå™Ô∏è birth month have "Strike" and "Push" by default.</li>
						<li>Units with üî• birth month have "Strike" and "Bleed" by default.</li>
						<li>Units with ‚õ∞Ô∏è birth month have "Strike" and "Defend" by default.</li>
						<li>Units with üíß birth month still only have "Strike".  Sorry, water benders!</li>
					</ul></li>
					<li>Enemies:<ul>
						<li>"Rat": 2 activations: "Strike" from front row; "Step" from mid/back row.</li>
						<li>"Golem": New enemy!</li>
					</ul></li>
					<li>Encounters:<ul>
						<li>"The Golems": Maybe this is like an Elite combat?  Better kill them before they catch up to you!</li>
					</ul></li>
					<li>Gameplay:<ul>
						<li>Basic Persistence: Your deck is saved after each combat, and is fed into the start of the next one.  Can't heal units yet though!</li>
						<li>Gold: You get 50 gold when you win a combat now.  Neat!  You also start with 50 gold.  Not that it's particularly useful yet...</li>
						<li>Card Mechanics: Updated to more closely resemble "normal" games:<ul>
							<li>You start each combat with 5 cards, and draw 1 card at the start of each round.  (You will start each combat with 6 cards effectively)</li>
							<li>You can no longer play cards to the discard pile to cycle your deck.  Instead, you can click on your deck icon to draw additional cards.  This costs an increasing amount of gold.</li>
							<li>The cost of drawing cards caps at 10 gold and increases by 1 for each additional draw.</li>
							<li>Your max hand size is 10 cards.  If you draw more, your leftmost card is discarded.</li>
							</ul>
						</ul></li>
					</ul></li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.3">
			<info-panel>
				<h2>V0.0.3</h2>
				<p>Changes:</p>
				<ul>
					<li>Unit Skills:<ul>
						<li>"Defend" skill: Updated to no longer stack: The largest source of block applies.  It also doesn't expire.</li>
						<li>"Distract" skill: Delays an enemy's next skill.  Also applies a debuff that removes its ability to combo.</li>
					</ul></li>
					<li>Player Units:<ul>
						<li>Units with üíß birth month start with Distract.</li>
					</ul></li>
					<li>Gameplay:<ul>
						<li>Rounds: Round structure has been changed.<ul>
							<li>Rather than have 8 volleys per round, now it will continue playing volleys until you choose to pause.</li>
							<li>There is a minimum number of volleys per play, however!  And that's 8.</li>
							<li>Guitar-hero scroll on the left is gone.</li>
						</ul></li>
						<li>Targeting:<ul>
							<li>Units now prioritize targets according to taunt status.</li>
							<li>Just because a unit is taunted, doesn't mean they will target that unit if there's shit in the way!</li>
						</ul></li>
						<li>Taunting: Units can now be taunted, which will change targeting.</li>
					</ul></li>
					<li>Cards:<ul>
						<li>"Hit That One!": Taunts an enemy unit.</li>
						<li>"Hit Me!": Taunts an ally unit.</li>
					</ul></li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.4">
			<info-panel>
				<h2>V0.0.4</h2>
				<p>Changes:</p>
				<ul>
					<li>Unit Skills:<ul>
						<li>Skills now have consistent activation rules (e.g. all Strikes have the same activation).</li>
						<li>Skills have a new activation zone: Close Quarters.  This is indicated by the arrow portion of the activation icon, and applies to enemy units in the same cell block as the unit.  Units in foreign cell blocks only have Close Quarters abilities available.</li>
						<li>"Strike": Attack. Front row and close quarters only.  Blocked entirely by barricades.</li>
						<li>"Throw": Attack. Middle row.  Unblocked by obstacles in the same block.</li>
						<li>"Shoot": Attack.  Back row.  If this unit has obstacles all up in its business, then it will hit that for half damage.  Otherwise, this will hit the intended target.</li>
						<li>"Defend": Active everywhere but the middle cell.</li>
						<li>"Protect": Active everywhere but the corner cells.  If an adjacent ally has low HP, gives them extra block.  Otherwise, applied to self.</li>
						<li>"Push": Front-row only.</li>
						<li>"Wind Blast": Back-row only version of Push.</li>
						<li>"Bleed": Front-row and close quarters only.</li>
						<li>"Sunder": Front-row and close quarters only.  Reduces block and applies vulnerability.</li>
						<li>"Distract" skill: Middle-row and close-quarters only.</li>
					</ul></li>
					<li>Player Units:<ul>
						<li>Units randomly have one of Strike, Throw, or Shoot. </li>
						<li>üå™Ô∏è Units randomly have one of Push or Wind Blast. </li>
						<li>üî• Units randomly have one of Bleed or Sunder. </li>
						<li>‚õ∞Ô∏è Units randomly have one of Protect or Defend. </li>
						<li>üíß Units only have Distract for now. </li>
					</ul></li>
					<li>Encounters:<ul>
						<li>Golems: Now immune to Bleed.  You're welcome, Jake.</li>
						<li>Jimmy, the Rat King: New boss fight to test Close Quarters mechanics.  Give it a try!</li>
					</ul></li>
					<li>Cards:<ul>
						<li>Starter Deck: 10 units instead of 8.</li>
						<li>"Barricade": The first preparation card!  Costs 3 gold to play, max 5 uses per combat, to drop a 30 HP barricade onto the battlefield.  The barricade can be taunted (either to direct enemies at it, or to direct allies at it to get it out of the way).</li>
					</ul></li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.4.1">
			<info-panel>
				<h2>V0.0.4</h2>
				<p>Changes:</p>
				<ul>
					<li>Basic Tutorial: Right-click the üë©‚Äçüè´ in the upper left to jump to the most relevant tutorial.</li>
					<li>Compendium Links are now underlined, and are either blue or yellow (depending on background).</li>
					<li>Red text in the compendium implies if you hover over it, it might highlight things on screen. Keep an eye out!</li>
					<li>If you hover over your abilities (either in cards or in combat), it will highlight the locations from which those abilities are active.</li>
					<li>In the Town screen, Start buttons are now Prepare buttons, where you're able to choose which units go on that encounter.</li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.5">
			<info-panel>
				<h2>V0.0.5</h2>
				<p>Changes:</p>
				<ul>
					<li>Outer Loop:<ul>
						<li>Added a day system.  A run now has 8 days (equivalent to one act).</li>
						<li>Added a Rumor system in which the day's options are seeded by rumors, which can be resolved either by engaging with them (successfully or otherwise), or by being ignored.</li>
						<li>Note that for now, every encounter re-adds itself, and Rats adds Jimmy.  See how many Jimmy's you can get in one run!</li>
						<li>Added a Hangout daily activity for your unassigned units that gives you a pittance and minor healing.</li>
						<li>Added a Doctor rumor that lets you heal 100 HP per unit for 20 gold per unit.</li>
					</ul></li>
					<li>Adventure Structure:<ul>
						<li>Added a basic storyboarding system that you can use to build a quest state machine out of vignettes and encounters.  Variables aren't supported yet.</li>
						<li>Updated Rats, Golems, and Jimmy to have a little set dressing.</li>
					</ul></li>
					<li>Guts:<ul>
						<li>Rewrote how encounters are launched (instead of being hardcoded, the battlefield is spawned separately and is driven by blueprints in the dom instead of being hardcoded in JS;  Enemies are still hardcoded in JS).</li>
					</ul></li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.5.1">
			<info-panel>
				<h2>V0.0.5.1</h2>
				<p>Changes:</p>
				<ul>
					<li>Bug Fixes:<ul>
						<li>Jimmy was broken.  Put Jimmmy back in his place.</li>
						<li>Town tutorial was busted due to a few shenanigans in how the town screen was initially rendered.</li>
					</ul></li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.5.2">
			<info-panel>
				<h2>V0.0.5.2</h2>
				<p>Changes:</p>
				<ul>
					<li>Engine:<ul>
						<li>Added a few optimizations to the effect queue, so now everything goes way faster.</li>
					</ul></li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.5.3">
			<info-panel>
				<h2>V0.0.5.3</h2>
				<p>Changes:</p>
				<ul>
					<li>Speed Button: Above the play/pause buttons.  Used to adjust how fast combat goes.  Use Cheetah mode to finish off the slogfest at the end!</li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.5.4">
			<info-panel>
				<h2>V0.0.5.4</h2>
				<p>Changes:</p>
				<ul>
					<li>Play/Pause/Step: Rewrote play/pause stuff: <ul>
						<li>Big Button: This is a play / stop button.  Play starts a round.  Stop ends the round as soon as is possible.  Easy!</li>
						<li>Pause Button: Left of Speed Button.  If you click pause, it will pause between every volley.  If you then click the (small) play button, it will no longer pause.</li>
						<li>Step Button: Only appears when the volley is paused.  Click to go.</li>
					</ul></li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.5.5">
			<info-panel>
				<h2>V0.0.5.5</h2>
				<p>Changes:</p>
				<ul>
					<li>Added a bunch of prep cards: <ul>
						<li>Throwing Knife:  Deal 5 damage to an enemy.</li>
						<li>Bull Potion: Boost a unit's damage by 3.</li>
						<li>Bear Potion: Boost a unit's block-gain by 3.</li>
						<li>Turtle Soup: +1 to all your cooldowns, gain 15 block.</li>
						<li>Cheetah Soup: -1 to all your cooldowns.</li>
						<li>Blink Crystal: Reposition, but instant teleport.</li>
						<li>Fire Bomb: Deal 50 damage in a bomberman cross pattern, permanently consumed on use.  This was originally 10, but I set it to 50 for testing and it felt fun.</li>
					</ul></li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.5.6">
			<info-panel>
				<h2>V0.0.5.6</h2>
				<p>Changes:</p>
				<ul>
					<li>Added a new Raven Hat prep card (instant retreat)</li>
					<li>Added richer Unit wiki: Right-clicking on a <span hover-helper="[wt~=Unit] .appearance">unit portrait</span> will show a detailed view in the info panel.</li>
					<li>Added Ghost Units:<ul>
						<li>When you place a unit, it is in <span hover-help="[wt~=GhostUnit]">pending state.</span></li>
						<li>Units in a pending state may be repositioned until one of the following happens: <ul>
							<li>The round is started</li>
							<li>You play a card on the unit</li>
							<li>You click the unit (to try to reposition it), and click the unit again to confirm it's where you want it.</li>
						</ul></li>
					</ul></li>
					<li>Tweaked a few things / made a few cards: <ul>
						<li>Cheetah Soup: Now reduces all your cooldowns to 1.</li>
						<li>Turtle Soup: Increases all your cooldowns by 2.</li>
						<li>Hustle!: New tactics card, decreases all cooldowns by 1.</li>
						<li>Wait for it!: New tactics card, increases all cooldowns by 1.</li>
					</ul></li>
					<li>Added some UI to the title screen around run seeds.  This does not work yet.</li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.5.7">
			<info-panel>
				<h2>V0.0.5.7</h2>
				<p>Changes:</p>
				<ul>
					<li>Added seeds: Units and combats should now be generated consistently when using the same seed.</li>
					<lu>The following things are NOT SEEDED (...yet): <ul>
						<li>Card order when drawing cards.</li>
						<li>Enemy AI actions (which spots rats try to run to, for example)</li>
						<li>Which unit says what during vignettes.</li>
					</ul></lu>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.5.8">
			<info-panel>
				<h2>V0.0.5.8</h2>
				<p>Changes:</p>
				<ul>
					<li>Added unit names.</li>
					<li>Refactored a bunch of code around the event queue.  I might have missed a few bugs. :(</li>
					<li>Added result tracking to the event queue.  This might slow down the game. :(</li>
					<li>Added close-quarters as a valid range option for throw and shoot, but they will only do one damage!</li>					
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.6">
			<info-panel>
				<h2>V0.0.6</h2>
				<p>Changes:</p>
				<ul>
					<li>Merchants: Every day, a few merchants will show up to your town.  You can spend your hard-earned gold to buy some items!</li>
					<li>Item Changes:<ul>
						<li>Most items will now exhaust or degrade.  Exhaust items have had their costs reduced to 0.</li>
						<li>Degrading items will permanently use a durability on their first use in combat, and all subsequent uses only temporarily use up the durability.</li>
					</ul></li>
					<li>Manage Items: A new screen that lets you move items around between units and storage.</li>
					<li>Embark: Embarking is now different.  You assign all your units at once, so you have a chance to shuffle them as much as you need to.</li>
					<li>Compendium changes: <ul>
						<li>Right-clicking on a quest/assignment will show you a hint in the info panel.</li>
						<li>Right-clicking on a preparation card will show you a copy of that card in the info panel.</li>
					</ul></li>
					<li>Tutorial Changes: Lots of tutorial changes.</li>
					<li>Trappings: Some colors adjusted per feedback.</li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.6.1">
			<info-panel>
				<h2>V0.0.6.1</h2>
				<p>Changes:</p>
				<ul>					
					<li>Visitors: Added weights to visitors, so some appear more frequently than others.  In addition, their weights change if they show up or if they don't.</li>
					<li>Merchants: Added a new merchant: the Mysterious Stranger.  He has something odd for sale, but better grab it, because you'll probably never see him again once he appears!</li>
					<li>Preparations: <ul>
						<li>Mystery Box: I wonder what it does?</li>
						<li>Ice Bomb: Freezes enemies for ~6 volleys.</li>
						<li>Gust Bomb: Pushes enemies away from a central point.</li>
						<li>Pebble Bomb: Shreds armor (and creates vulnerability).</li>
					</ul></li>
					<li>Game: Upped the max number of days to 32 days (up from 8).</li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.6.2">
			<info-panel>
				<h2>V0.0.6.2</h2>
				<p>Changes:</p>
				<ul>					
					<li>Made card draw/discard obey seeded RNG.</li>
					<li>Mostly refactoring / prep for new encounters and events and wanted to checkpoint.</li>
				</ul>
			</info-panel>
		</version>

		<version hash="0.0.7">
			<info-panel>
				<h2>V0.0.7</h2>
				<p>Changes:</p>
				<ul>					
					<li>Lots of little rewrites: <ul>
						<li>Wrote a bunch of unit-gen logic.  Migrated all unit creation to use the proc-gen unit generation code path.</li>
						<li>Write a bunch of encounter-gen logic. Migrated all encounter creation to use the proc-gen encounter generation code path.</li>
						<li>Rewrote all pathing / movement logic to factor in the ability to move between blocks.  There's still wonkiness here.</li>
						<li>Rewrote how unit damage/defense are tracked.</li>
						<li>Rewrote how combat end conditions are determined.</li>
					</ul></li>
					<li>Added a new enemy (Pill Bug) with 2 variations: One that shoots, one that strikes.  Strikes cause it to gain Block when hit.</li>
					<li>Added a new annoying neutral obstacle: The web.  Takes minimal damage from Throw/Shoot.</li>
					<li>Added a new assignment/quest area: The Lost City / Ruined City (I forget which I called it)<ul>
						<li>Added a new combat, the Hall of Bugs.  May migrate golems to this overarching chain as well.</li>
					</ul></li>
				</ul>
			</info-panel>
		</version>

		<tutorial hash="title">
			<info-panel>
				<h2>Thank you for trying this!</h2>

				<p>Welcome to my playtest, and thank you for trying this!</p>
				<p>At any time, right-click on the üë©‚Äçüè´ emoji in the upper-left to jump to a relevant tutorial!</p>
				<p>To jump right into how-to-play, <span compendium="tutorial/title2">Right click on this text.</span></p>
				<p>I am open to all constructive feedback.  Things I want you to focus on include: <ul>
					<li>Missing pieces of critical functionality.  Examples include:<ul>
						<li>"It's too difficult to engage with X part of the game because Y is missing."</li>
					</ul></li>
					<li>Issues with core mechanics, such as: <ul>
						<li>"The volley structure is too fussy" (actual feedback that radically changed the game between 0.0.2 and 0.0.3!)</li>
					</ul></li>
					<li>Ideas for mechanics, cards, skills, encounters, or anything else, really!</li>
					<li>If you would like an easter-egg unit, tell me:<ul>
						<li>Your birthday</li>
						<li>In preference order, 3 of the following emoji: ü§©üòóüòÄüòÅü§£üôÉüòâüòúü§ëü§êüòëüò¨üò¥ü§Æüòµü§†ü§ìüßêüò±üê±</li>
						<li>What name you want your unit to have.</li>
					</ul></li>
				</ul></p>
			</info-panel>
		</tutorial>

		<tutorial hash="title2">
			<info-panel>
				<h2>Getting Started</h2>

				<p>Note that if text is underlined and yellow or blue (depending on background), right-click it and this panel should update!</p>
				<p>If text in the compendium is red, hover over it to highlight things in the main play area to look at!</p>

				<p>From the title screen, click the <span hover-help="[wt=StartButton]">Start button</span> to start a run!</p>
			</info-panel>
		</tutorial>
		
		<tutorial hash="townscreen">
			<info-panel>
				<h2>Town Screen</h2>

				<p>For now, your goal in this game is to make as much money as possible while keeping as many units alive as you can.</p>
				<p>The top bar shows current run info.  The only useful thing there for now is your <span hover-help=".run_bar .gold_container">current Gold</span>, represented by a yellow circle: üü°</p>
				<p>In general, üü° with a number in it indicates that it costs that much to do the thing.</p>

				<p>In the town screen, you can do the following:<ul>
					<li><span hover-help="[wt~=StorageButton]">Manage Items</span>: You have a stash of items, and a bunch of units that can bring them into combat.  This button allows you to swap items around your units.</li>
					<li><span hover-help="[wt~=GoShopping]">Go Shopping</span>: Spend your gold on new items.  Any purchased items will go to your storage.</li>
					<li><span hover-help="[wt~=Go]">Embark</span>: Send your units out on their <span hover-help=".town_assignment">adventures</span> for some <span hover-help="result">rewards</span>.</li>
				</ul></p>

				<p>Feel free to go shopping and assign some items to your units, then <span hover-help="[wt~=Go]">Embark!</span></p>
			</info-panel>
		</tutorial>

		
		<tutorial hash="vignette">
			<info-panel>
				<h2>Story Vignette</h2>

				<p>For now, this is flavor text, but eventually there will be actual impact from what happens in these!</p>
				<p>Feel free to read the hastily-thrown-together flavor text, then click a <span hover-help="[wt~=Choice]">button</span> to proceed.</p>
			</info-panel>
		</tutorial>

		<tutorial hash="encounterscreen">
			<info-panel>
				<h2>Encounter!!</h2>

				<p>Each encounter has an objective and a losing condition.  In general, you win if all <span hover-help="[wt~=Unit][team=enemy] .appearance">enemies</span> are dead, and you lose if all <span hover-help="[wt~=Unit][team=player] .appearance">allies</span> die and you have no units left to play.</p>
				<p>The screen is broken up into a few sections: <ul>
					<li><span hover-help="[wt~=EncounterScreen] .preview_panel">Left Panel</span>: Under Construction!</li>
					<li><span hover-help="[wt~=EncounterScreen] .battlefield_widget_container">Center Panel</span>: The Battlefield</li>
					<li><span hover-help="[wt~=CardHud]">Bottom Panel</span>: The Card HUD</li>
					<li><span hover-help="[wt~=ActionButton]">Bottom-Right Circle Bitton</span>: The Action Button</li>
				</ul></p>

				<p>During an Encounter, your goal is to play <span hover-help="[wt~=Card]">cards</span> onto the battlefield that will allow you to win the encounter.</p>

				<p>To play a card, click it once.  If the card does not move up slightly, it means you can't play that card.  This generally means it has no valid targets, or you can't afford it.  Valid targets for the card will begin blinking obnoxiously.  Click one of the blinking targets to play the card on that target.</p>

				<p>When a card hasn't been played yet, you can cancel by clicking the card again, or clicking the <span hover-help="[wt~=ActionButton]">Action Button containing a üö´ symbol</span>.</p>

				<p>Some targets blink more obnoxiously than others: Those are priority targets.  It's generally a good idea to play cards on priority targets.</p>

				<p>If you don't like the cards in your hand, you can click the <span hover-help="[wt~=DrawPileUi]">Deck symbol</span> on the left side of the car UI.  Note that drawing cards out of turn costs gold!  You can have up to 10 cards in hand: if you would draw more, the leftmost card is discarded to the <span hover-help="[wt~=Discard]">discard pile</span>.  Once your draw pile runs out of cards, your discard pile is shuffled into a new draw pile.</p>

				<p>For now, play a few <span hover-help="[wt~=Card] [wt~=Unit]">Unit cards</span> onto the battlefield.  If you have none, draw cards from the draw pile until you do.  Be sure to choose a location that blinks obnoxiously.</p>

				<p>When you first play a unit onto the battlefield, it's in a <span hover-help="[wt~=GhostUnit]">pending state</span>, where its avatar has muted colors.  Units in this state<ul>
					<li>Can be repositioned.  To do so, click the unit and click the destination cell.</li>
					<li>May not have certain cards played on them until they are no longer pending.</li>
					<lI>Are made no-longer pending.  To do so, click the unit, then click the unit again.</lI>
				</ul></p>

				<p>Once you've played some units, click the <span hover-help="[wt~=ActionButton]">Action Button with a ‚ñ∂Ô∏è symbol</span> to start a round.  Any pending units will no longer be pending once the round starts.  Units and enemies will take turns using their abilities.  Each of these turns is called a Volley.</p>

				<p>By default, volleys play one step at a time, which you can progress by clicking the <span hover-help="[wt~=StepButton]">Step Forward</span> button.  Click the <span hover-help="[wt~=PlayPauseButton]">Pause/Resume</span> button to toggle between auto-play or pause between volleys, which will hide the <span hover-helper="[wt~=StepButton]">Step Forward</span> button while it's in auto-play.  In addition, you can toggle the speed of a volley using the <span hover-help="[wt~=SpeedButton]">Speed Control</span>, which as 3 modes: üêå (slow), üêï(standard), and üçë(hold-onto-your-butts, aka fast).</p>

				<p>To end the round, click on the <span hover-help="[wt~=ActionButton]">Action Button with a ‚èπÔ∏è symbol</span>.  Note that before you can play cards again, a minimum number of Volleys must pass.  This is represented by the top number in the <span hover-help=".volley_tracker">Volley Tracker hourglass symbol</span>.  The <span hover-help="[wt~=ActionButton]">Action Button</span> will display a ‚åõ symbol while it is waiting for the minimum number of volleys to pass.  This may require that you click the</p>

				<p>Once the round ends, you will once again be able to play cards.  Note that some game effects end when the round ends, so sometimes it's to your benefit to not end a round.</p>				

				<p>Above each unit on the battlefield, you'll see a <span hover-help="[wt~=Battlefield] [wt~=Ability]">vomit of icons</span>.  These icons represent the unit's Intents, which is what they plan to do during the battle.</p>

				<p>The large icon on top is the category of move.  The small icon to the bottom-left is the actual move's icon.  The number is the cooldown for that move.  The move will be used in a volley if its cooldown value is 1.  If there are multiple such moves for a unit, the leftmost is used.  Once a move is used, its cooldown resets.</p>

				<p>Some <span hover-help="[wt~=Battlefield] [wt~=Ability][inactive=true]">moves cannot be used because the unit is in the wrong position</span>.  Hover over those icons to highlight the correct positions for those moves.  If your units are unable to act, try to play a card that lets you move that unit to a better position.</p>

				<p>When multiple compatible units use moves at the same time, they can <span compendium="concept/unit/concept/combo">combo</span>.  Combos have extra UI treatment and are simply more powerful versions of the same effect (e.g. Strike deals +25% damage for every additional unit that is part of the combo).  Check out the <span compendium="concept/unit/concept/combo">combo</span> page for more info on when units can combo, but the TL;DR is matching cooldowns and either matching element symbols or similar moon icons.</p>

				<p>A few last points: <ul>
					<li>If a unit dies, they are gone forever!</li>
					<li>HP is not restored between combats/rounds.  To heal your units, you need to pay the doctor in town!</li>
				</ul></p>
			</info-panel>
		</tutorial>

		<tutorial hash="manageitems">
			<info-panel>
				<h2>Manage Items</h2>

				<p>This dialog allows you to equip your units with item cards.</p>

				<p>Select a unit by clicking a <span hover-help=".units_holder .card">unit card</span>.  The currently-selected one glows annoyingly.</p>

				<p>Their items will be shown in the <span hover-help=".unit_preview">panel below</span>.</p>

				<p>You can move items to the unit's inventory by clicking an <span hover-help="[wt~=Dialog] .card > [wt~=Item]">item in storage</span>.</p>

				<p>You can move items back to storage by clicking the <span hover-help="[wt~=Dialog] .battlefield_unit inventory [wt~=Item]">item in the unit's inventory.</span></p>

				<p>You can click the <span hover-help="[wt~=EmptyAll]">Empty All Units button</span> to move all units items back to storage.</p>

				<p>When you're done, click <span hover-help="[wt~=Okay]">Done</span>.</p>

			</info-panel>
		</tutorial>

		<tutorial hash="shop">
			<info-panel>
				<h2>Shop</h2>

				<p>Spend your <span hover-help=".run_bar .gold_container">Gold</span> on sweet <span hover-help=".shop_item">merch for sale</span>.</p>
				<p>Hopefully it's obvious, but you can only buy things <span hover-help="[can-afford=true]">that you can afford.</span></p>
				<p>Things you own are shown in <span hover-help=".storage_holder">Your storage</span>.  You can't sell things; it's only here so you can see what you already have laying around.</p>
				<p>When you're done shopping, click <span hover-help="[wt~=Okay]">Done.</span></p>

			</info-panel>
		</tutorial>

		<tutorial hash="embark">
			<info-panel>
				<h2>Embark</h2>

				<p>This is where you assign <span hover-help="[wt~=Card]">units</span> to <span hover-help=".town_assignment">missions.</span></p>
				<p><span hover-help=".town_assignment [wt~=Card]">Units already assigned to missions</span> will appear within the mission's row.  You can click the unit cards to unassign them, back into the <span hover-help=".units_holder">pending area</span>.</p>
				<p>All units must be assigned before you can <span hover-help="[wt~=Okay]">embark</span>.</p>
				<p>For now, click the <span hover-help="[wt~=Reset]">Reset Assignments</span> button to unassign all your units.</p>
				<p>You can select one or more <span hover-help=".units_holder [wt~=Card]">unassigned units</span> by clicking them.  Units that are selected will be fully opaque and have a flashing border.  Select a few now.</p>				
				<p>After selecting a few, some <span hover-help="[wt~=AddUnit]">Plus buttons</span> will appear in the mission rows.  Click that button to assign all selected units to that mission.</p>
				<p>You can right click a <span hover-help=".quest_name">mission title</span> to view a hint for that mission.  Remember you can <span hover-help=".tutorial_button">return to this tutorial by right-clicking the üë©‚Äçüè´</span> icon in the upper-left!</p>
				<p>If this is your first time playing, choose 5 units to assign to <span hover-help="[wt~=Assignment][name=rats]">The Rats</span>.  Choose units whose <span hover-help="[wt~=Ability]">abilities</span> have similar numbers and whose <span hover-help="[wt~=Card] .appearance">avatars</span> have similar non-face icons.</p>
				<p>Assign your other 5 units to <span hover-help="[wt~=Assignment][name=hangingout]">Hang Around The Base</span>, then click <span hover-help="[wt~=Okay]">Embark!</span></p>
				<p>If you want to go shopping and to rearrange items, you can click <span hover-help="[wt~=Cancel]">the go-back-to-town button</span>.</p>
			</info-panel>
		</tutorial>

		<concept hash="coolseeds">
			<info-panel>
				<h2>Cool Seeds</h2>
				<p>Page for seeds that have neat or silly generation.</p>
				<p><ul>
				</ul></p>
			</info-panel>
		</concept>

		<concept hash="ideas">
			<info-panel>
				<h2>Idea Log</h2>
				<ul>
					<li>Starting fresh here!</li>
				</ul>
			</info-panel>
		</concept>


		<concept hash="events">
			<info-panel>
				<h2>Events</h2>
				<p>Events are the implementation of assignments.  Basically:<ul>
					<li>A rumor becomes an assignment</li>
					<li>An assignment in progress is an event</li>
				</ul></p>
				<p>Events are basically like state machines.</p>

				
			</info-panel>

			<!-- Remaining examples start here. -->
			<event-blueprint name="hunt_for_food" label="Hunt for Food">
				<state type="vignette" name="start" start="true">
					<flavor>
						<p>You're here to get some food for your group of humans.</p>
						<p>Kill the antelope as they cross to get some food!</p>
					</flavor>
					<choice result="1" label="Can do!"></choice>
					<event-result choice="1" next-state="fight"></event-result>	
				</state>
				<state type="encounter" name="fight">
					<encounter base="base">
						<battlefield base="herd_crossing">
							<!-- TODO: Make this work. -->
							<forCells labels="B3.A3 B3.B3 B3.C3">
								<add tag="spawn"></add>
							</forCells>
							<forCells labels="A2.A1 A2.A2 A2.A3 C2.C1 C2.C2 C2.C3 B1.A1 B1.B1 B1.C1">
								<add tag="escape"></add>
							</forCells>
						</battlefield>
						<endCondition end-fn="EncounterRules.Endless" type="win">
							You're stuck here forever!  Go go dev.
						</endCondition>
						<installHandlers>
							<!-- TODO: Make this work with the spawn tags. -->
							<handler handler="HuntForFoodEncounter.SpawnDeer" event-types="Volley:before" spawn-count="20" spawn-selector="[tag~='spawn']" location-filter="HuntForFoodEncounter.SpawnLocationFilter">
								<unit-gen base="deer">
									<copy team="enemy" preferred-locations="B1.A1 B1.B1 B1.C1"></copy>
									<add tag="deer"></add>
									<forMoveSlots selector="[tag=basic]">
										<copyDest cooldown-duration="12"></copyDest>
									</forMoveSlots>
								</unit-gen>
							</handler>
					</encounter>
					<event-result choice="victory" victory="true"></event-result>
					<event-result choice="wipe" victory="false"></event-result>
					<event-result choice="giveUp" victory="false"></event-result>
				</state>
			</event-blueprint>

			<!-- This is left here as a complex example.  -->
			<event-blueprint name="lost_city" label="The Lost City">
				<state type="vignette" name="gates" start="true">
					<flavor>
						<p>You stand outside the gates of the ruined city.  What treasures and wonders lie within?</p>
					</flavor>
					<choice result="1" label="Step through the gate [Outer City]"></choice>
					<event-result choice="1" next-state="outer_city"></event-result>
				</state>

				<!-- Outer City -->
				<!-- You were going to refactor these defs.  See DefHelper.baseDef.
				     TL;DR: global.outer_progress instead of what's here. -->
				<def name="outer_progress" value="0" global="true"></def>
				<def name="outer_boss_alive" value="true" global="true"></def>
				<state type="vignette" name="outer_city">
					<flavor>
						<p>You walk through the outer ring of the lost city.</p>
					</flavor>
					<!-- TODO: Make this somewhat dynamic so you can only win each encounter once. -->
					<choice-group choose="3">
						<choice result="outer_boss" label="Hey, who is that big guy over there?" filter-fn="LostCity.progress" progress-min="6" params="outer_progress" flag="outer_boss_alive" priority="true"></choice>

						<choice result="hall_of_bugs" label="I wonder where that passage leads?" flag="hall_of_bugs"></choice>

						<choice result="leave" label="Let's head home. [END]" fallback="true"></choice>
						<choice result="gates" label="Maybe we should go back to the gates and regroup?" fallback="true"></choice>
					</choice-group>
					<event-result choice="leave" victory="false"></event-result>
					<event-result choice="gates" next-state="gates"></event-result>
					<event-result choice="outer_boss" next-state="outer_boss"></event-result>
					<event-result choice="hall_of_bugs" next-state="hall_of_bugs"></event-result>
				</state>

				<!-- Bug Hallway -->
				<def name="hall_of_bugs" value="true" global="true"></def>
				<state type="vignette" name="hall_of_bugs" label="Webbed Passage">
					<flavor>
						<p>This large archway was clearly an important thoroughfare at some point, though now it is collapsed and covered in webs.</p>
					</flavor>
					<choice result="fast" label="Stick together! [Combat: +2 March]"></choice>
					<choice result="careful" label="Rush through! [Combat: +4 Reposition]"></choice>
					<choice result="fire" label="Nothing a well-placed firebomb can't fix! [Combat: Lose Fire Bomb, +1 March, +2 Reposition]" filter-fn="LostCity.ItemAvailable" item="fireBomb"></choice>
					<event-result choice="fast" next-state="hall_of_bugs_fight">
						<def name="hall_of_bugs_webs" value="true"></def>
						<def name="hall_of_bugs_fast" value="true"></def>
					</event-result>
					<event-result choice="careful" next-state="hall_of_bugs_fight">
						<def name="hall_of_bugs_webs" value="true"></def>
						<def name="hall_of_bugs_careful" value="true"></def>
					</event-result>
					<event-result choice="fire" next-state="hall_of_bugs_fight">
						<remove-item item="fireBomb"></remove-item>
						<def name="hall_of_bugs_medium" value="true"></def>
					</event-result>
				</state>
				<state type="encounter" name="hall_of_bugs_fight" label="Webbed Passage">
					<encounter>
						<battlefield bp="hallway"></battlefield>
						<place-units location="A2" count="3">
							<from-unit-gen name="pill_bug"></from-unit-gen>
						</place-units>
						<place-units location="A2" count="2" flag="hall_of_bugs_webs">
							<from-unit-gen name="web_scenery"></from-unit-gen>
						</place-units>
						<place-units location="A3" count="3">
							<from-unit-gen name="pill_bug"></from-unit-gen>
						</place-units>
						<place-units location="A3" count="2" flag="hall_of_bugs_webs">
							<from-unit-gen name="web_scenery"></from-unit-gen>
						</place-units>
						<place-units location="A4" count="3">
							<from-unit-gen name="pill_bug"></from-unit-gen>
						</place-units>
						<place-units location="A4" count="2" flag="hall_of_bugs_webs">
							<from-unit-gen name="web_scenery"></from-unit-gen>
						</place-units>
						<end-condition end-fn="EndConditions.AllAlliesIn" location="A4" type="win">
							Move all your units on the battlefield <span hover-help="[wt~=CellBlock][beeg-label=A4]">here!</span>
						</end-condition>
						<end-condition end-fn="EncounterRules.DefaultWipe" type"lose">
							You lose if all your units die!
						</end-condition>
						<bonus-cards>
							<tactic bp="march"></tactic>
						</bonus-cards>
						<bonus-cards flag="hall_of_bugs_careful">
							<tactic bp="reposition"></tactic>
							<tactic bp="reposition"></tactic>							
							<tactic bp="reposition"></tactic>							
							<tactic bp="reposition"></tactic>							
						</bonus-cards>
						<bonus-cards flag="hall_of_bugs_fast">
							<tactic bp="march"></tactic>
							<tactic bp="march"></tactic>
						</bonus-cards>
						<bonus-cards flag="hall_of_bugs_medium">
							<tactic bp="march"></tactic>
							<tactic bp="reposition"></tactic>							
							<tactic bp="reposition"></tactic>							
						</bonus-cards>
						<combat-script>
							<handler label="SpawnBugs" handler="HallOfBugs.OnAfterVolley" event-types="Volley:after">
								<place-units location="A2" count="3">
									<from-unit-gen name="pill_bug"></from-unit-gen>
								</place-units>		
							</handler>
							<!-- Handlers go here! -->
						</combat-script>
					</encounter>
					<event-result choice="victory" next-state="hall_of_bugs_win">
						<!-- Set it to true for now until I have enough combats to fill the outer city. -->
						<def name="hall_of_bugs" value="true"></def>
						<def name="outer_progress" fn="LostCity.MakeProgress" params="outer_progress"></def>
					</event-result>
					<event-result choice="wipe" next-state="hall_of_bugs_wipe"></event-result>
					<event-result choice="giveUp" next-state="hall_of_bugs_retreat"></event-result>
				</state>
				<state type="vignette" name="hall_of_bugs_win" label="Webbed Passage">
					<flavor>
						<p>Congrats!  You've cleared the path for next time! I should write more.</p>
					</flavor>
					<choice result="1" label="Head back"></choice>
					<event-result choice="1" victory="true">
					</event-result>
				</state>
				<state type="vignette" name="hall_of_bugs_wipe" label="Webbed Passage">
					<flavor>
						<p>They were eaten by the bugs. :(</p>
					</flavor>
					<choice result="1" label="Well, that sucks"></choice>
					<event-result choice="1" victory="false">
					</event-result>
				</state>
				<state type="vignette" name="hall_of_bugs_retreat" label="Webbed Passage">
					<flavor>
						<p>Screw that noise.  Maybe there's somewhere else we can go.</p>
					</flavor>
					<choice result="1" label="Look Elsewhere"></choice>
					<choice result="2" label="Head back home [END]"></choice>
					<event-result choice="1" next-state="outer_city"></event-result>
					<event-result choice="2" victory="false"></event-result>
				</state>

			</event-blueprint>			
		</concept>

		<concept hash="encounter">
			<info-panel>
				<h2>Encounters</h2>
				<p>Encounters are combat.  I don't want to rename them all though.</p>
			</info-panel>

			<!-- Default encounter setup scripts. -->
			<encounter-gen name="base">
				<!-- Update initiative order if needed. -->
				<ifAllDef keys="playersSurprised">
					<copyDest initiative-order="enemy player neutral"></copyDest>
				</ifAllDef>

				<!-- Set up retreat options. -->
				<ifAllDef keys="retreatPossible">
					<bonusCards>
						<!-- Retreat card goes here. -->
					</bonusCards>
				</ifAllDef>

				<!-- Set up handlers -->
				<installHandlers>
					<!-- Encounter Structure -->
					<handler handler="EncounterRules.Round" event-types="Round"></handler>
					<handler handler="RoundRules.PlayRound" event-types="PlayRound"></handler>
					<handler handler="RoundRules.Volley" event-types="Volley"></handler>
					<handler handler="RoundRules.TickCooldowns" event-types="Volley:after"></handler>
					<handler handler="RoundRules.UseMove" event-types="UseMove"></handler>
					<handler handler="RoundRules.BlockActivation" event-types="BlockActivation"></handler>
					<handler handler="RoundRules.ActivateGroup" event-types="ActivateGroup"></handler>
					<handler handler="UnitRules.UseAbility" event-types="UseAbility"></handler>

					<!-- Combat effects -->
					<handler handler="UnitRules.Attack" event-types="Attack"></handler>
					<handler handler="UnitRules.TakeDamage" event-types="TakeDamage"></handler>
					<handler handler="UnitRules.UnitDeath" event-types="UnitDeath"></handler>
					<handler handler="UnitRules.UnitRetreat" event-types="UnitRetreat"></handler>
					<handler handler="UnitRules.UnitMoveToward" event-types="UnitMoveToward"></handler>
					<handler handler="UnitRules.ShiftUnit" event-types="ShiftUnit"></handler>
					<handler handler="UnitRules.PushUnit" event-types="PushUnit"></handler>
					<handler handler="UnitRules.UnitCollision" event-types="UnitCollision"></handler>
					<handler handler="UnitRules.ApplyStatus" event-types="ApplyStatus" TODO></handler>
					<handler handler="UnitRules.RemoveStatus" event-types="RemoveStatus" TODO></handler>

					<!-- Handlers for card behavior -->
					<handler handler="CardRules.DrawCard" event-types="DrawCard"></handler>
					<handler handler="CardRules.RefillHand" event-types="RefillHand"></handler>
					<handler handler="CardRules.DiscardCards" event-types="DiscardCards"></handler>
					<handler handler="CardRules.DiscardSingleCard" event-types="DiscardSingleCard"></handler>
					<handler handler="CardRules.ShuffleDiscard" event-types="ShuffleDiscard"></handler>
					<handler handler="CardRules.PlayCard" event-types="PlayCard" TODO></handler>
				
					<!-- Handlers for structural UI effects-->
					<handler label="EndOfCombat" handler="UiTreatments.OnAfterUiEffect" event-types="Encounter:after" skip-log="true">
						<ui-effect type="delay" delay="1000"></ui-effect>
						<ui-effect type="banner" content-fn="EncounterRules.EndOfEncounterBanner"></ui-effect>
					</handler>

					<!-- Handlers for UI Effects -->
					<handler label="VolleyDelay" handler="UiTreatments.OnAfterUiEffect" event-types="Volley:after" skip-log="true">
						<ui-effect type="delay" delay-fn="VolleyCounter.VolleySpeed" delays="500 100 0"></ui-effect>
					</handler> 
					<handler label="DamageNumbers" handler="UiTreatments.OnAfterUiEffect" event-types="TakeDamage:after" target-fn="UnitRules.TakeDamageUnit" skip-log="true">
						<ui-effect type="delay" delay-fn="VolleyCounter.VolleySpeed" delays="0 0 NaN"></ui-effect>
						<ui-effect type="blink" blink-color="red"></ui-effect>
						<ui-effect type="text" color="red" shadow="black" text-fn="UnitRules.TakeDamageAmount" start-transform="translateY(0px)" end-transform="translateY(-50px)"></ui-effect>
					</handler>
					<handler label="DeathIcon" handler="UiTreatments.OnAfterUiEffect" event-types="UnitDeath:before" target-fn="UnitRules.UnitDeathUnit" skip-log="true">
						<ui-effect type="wub" icon="‚ò†Ô∏è"></ui-effect>
					</handler>
					<handler label="RetreatIcon" handler="UiTreatments.OnAfterUiEffect" event-types="UnitRetreat:before" target-fn="UnitRules.UnitDeathUnit" skip-log="true">
						<ui-effect type="wub" icon="üè≥Ô∏è"></ui-effect>
					</handler>
					<handler label="CollisionIcon" handler="UiTreatments.OnAfterUiEffect" event-types="UnitCollision:after" skip-log="true">
						<ui-effect type="wub" icon="üí•" target-fn="UiTreatments.TargetsFromParams" target-param="firstUnit secondUnit"></ui-effect>
					</handler>
					<handler label="PushWhoosh" handler="UiTreatments.OnAfterUiEffect" event-types="ShiftUnit:before" skip-log="true">
						<ui-effect type="wub" icon="üí®" target-fn="UiTreatments.TargetsFromParams" target-param="unit" filter-fn="UnitRules.ShiftFromPush"></ui-effect>
					</handler>
					<handler label="ComboTreatments" handler="UiTreatments.OnAfterUiEffect" event-types="ActivateGroup:before" skip-log="true">
						<ui-effect type="blink" filter-fn="RoundRules.ActivateGroupHasCombo" target-fn="RoundRules.ActivateGroupUnits" blink-color="yellow"></ui-effect>
						<ui-effect type="banner" filter-fn="RoundRules.ActivateGroupHasCombo" content-fn="RoundRules.ActivateGroupBanner" extra-classes="slow"></ui-effect>
						<ui-effect type="delay" filter-fn="RoundRules.ActivateGroupHasCombo" delay-fn="VolleyCounter.VolleySpeed" delays="1500 1500 200"></ui-effect>
					</handler>
					<handler label="AbilityName" handler="UiTreatments.OnAfterUiEffect" event-types="UseAbility:before" skip-log="true">
						<ui-effect type="text" color="white" shadow="black" text-fn="UnitRules.UseAbilityName" target-fn="UnitRules.UseAbilityUnit"></ui-effect>
						<ui-effect type="delay" delay-fn="VolleyCounter.VolleySpeed" delays="50 0 NaN"></ui-effect>
					</handler>

					<!-- Handlers for updating functional UI -->
					<handler label="ActionButtonVolley" handler="EncounterRules.RemoveStopBeforeRound" event-types="Round:before"></handler>
					<handler label="ActionButtonVolley" handler="EncounterRules.BlockAfterVolleyIfPaused" event-types="Volley:after"></handler>	
					<handler label="UnitPreAbility" handler="Unit.BeforeUseAbility" event-types="UseAbility:before"></handler>
					<handler label="UnitPostAbility" handler="Unit.AfterUseAbility" event-types="UseAbility:after"></handler>
					<handler label="VolleyTrackerRound" handler="VolleyCounter.AfterPlayRound" event-types="PlayRound:after"></handler>
					<handler label="VolleyTrackerVolley" handler="VolleyCounter.AfterVolley" event-types="Volley:after"></handler>
					<handler label="VolleyTrackerVolley" handler="VolleyCounter.BeforeVolley" event-types="Volley:before"></handler>

				</installHandlers>
			</encounter-gen>

			<encounter-gen name="default" base="base">
				<!-- Default encounter-end conditions. -->
				<endCondition end-fn="EncounterRules.DefaultWin" type="win">
					Defeat all enemies to win!
				</endCondition>

				<endCondition end-fn="EncounterRules.DefaultWipe" type"lose">
					You lose if all your units die!
				</endCondition>
			</encounter-gen>

			<!-- Battlefield generation -->
			<battlefield-gen name="basic_cross">
				<geo battlefield-fn="BattlefieldGen.generateRect" width="3" height="3"></geo>
				<forBlocks labels="A1 A3 C1 C3">
					<copy disabled="true"></copy>
				</forBlocks>
			</battlefield-gen>

			<battlefield-gen name="herd_crossing" base="basic_cross">
				<forBlocks labels="A2 C2">
					<copy team="player"></copy>
				</forBlocks>
				<forBlocks labels="B1 B2 B3">
					<copy team="enemy"></copy>
				</forBlocks>
			</battlefield-gen>
		</concept>
		
		<concept hash="assignments">
			<info-panel renderer="Compendiums.RenderAssignment">
				<h2>Assignments</h2>

				<p>Assignments are basically quests.  I dunno why I didn't just call them that in the first place.</p>
				<p>You send units on these when you embark, and you may get <span compendium="concept/assignments/concept/results">rewards</span> when you return.</p>

				<template>
					<p>Right-click <span compendium="concept/assignments">here for the base page on assignments</span></p>
					<div class="compendium_view">

					</div>
				</template>
			</info-panel>

			<concept hash="results">
				<info-panel>
					<h2>Assignment Results</h2>
					<p>Possible results from an adventure thing are money and healing.  More to come!</p>
				</info-panel>
			</concept>
			
			<concept hash="cost">
				<info-panel>
					<h2>Rumor Costs</h2>
					<p>Some rumors cost money to buy.  If it's a flat cost, it's just listed.  If it's per-unit, there's a face added to it.</p>
					<p>If the button is greyed out, you don't meet the requirements.  For example, medical help requires units that are missing HP.</p>
				</info-panel>
			</concept>

			<!-- Left as an example.  Ideally this would be propulated based on your save state. -->
			<starting-rumors>
				<!-- <assignment bp="lost_city"></assignment> -->
				<assignment bp="hunt_for_food"></assignment>
			</starting-rumors>

			<result-handlers>
				<!-- In priority order! -->
				<result-handler type="add-gold" fn="GameRules.AddGoldResult"></result-handler>
				<result-handler type="add-rumor" fn="GameRules.AddRumorResult"></result-handler>
				<result-handler type="heal-units" fn="GameRules.HealUnitsResult"></result-handler>
			</result-handlers>

			<default-assignment assignment-invoke-fn="GameRules.LaunchEvent"></default-assignment>

			<!-- This is the one you're working on.  -->
			<assignment-blueprint name="hunt_for_food">
				<info label="Hunt for food"></info>
				<event bp="hunt_for_food"></event>
				<assign max-units="5" require="false" req-label="Up to 5 units"></assign>
			</assignment-blueprint>

			<assignment-blueprint name="lost_city">
				<info label="Explore the Ruined City"></info>
				<event bp="lost_city"></event>
				<assign max-units="5" require="false" req-label="Up to 5 units"></assign>
				<info wt="Hint">A quest chain I intend to build out to be many adventures deep.  Be on your toes!"</info>
				<result>
					<add-rumor>
						<assignment bp="lost_city"></assignment>
					</add-rumor>
				</result>
				<result victory="true">
					<add-gold amount="50"></add-gold>
				</result>
			</assignment-blueprint>

			<!-- Assignments that are otherwise later available. -->
			<assignment-blueprint name="hangingout">
				<config></config>
				<info assignment-invoke-fn="GameRules.LaunchEffect"></info>
				<info encounter-fn="Events.success"></info>
				<info default-for-units="true"></info>
				<info label="Hang Around Base"></info>
				<info wt="Hint">This is what units do by default.  You probably have better choices!</info>
				<assign required="false" req-label="Each unit finds 1 gold and heals 5 HP"></assign>
				<result>
					<add-gold amount-fn="Events.hangOutGold" amount="1+"></add-gold>
 				</result>
				<result>
					<heal-units amount="5"></heal-units>
				</result>
			</assignment-blueprint>


		</concept>

		<concept hash="visitor">
			<info-panel>
				<h2>Visitor</h2>
				<p>These people sell you stuff and tell you about interesting rumors!</p>				
			</info-panel>
			
			<!-- TODO: Rethink this. -->
			<starting-visitors>
				<!-- 
				<visitor bp="mysterious_stranger"></visitor>
				<visitor bp="soldier"></visitor>
				<visitor bp="artificer"></visitor>
				<visitor bp="apothecary"></visitor> -->
			</starting-visitors>

			<!-- Visitors -->
			<visitor-blueprint name="soldier">
				<info frequency="8" on-join-fn="Visitors.HalfFrequency" on-skip-fn="Visitors.PlusOneFrequency"></info>
				<info appearance-options="üë®‚Äçüè≠ üë©‚Äçüè≠"></info>
				<merchant bp="soldier"></merchant>
			</visitor-blueprint>
			
			<visitor-blueprint name="artificer">
				<info frequency="7" on-join-fn="Visitors.HalfFrequency" on-skip-fn="Visitors.PlusOneFrequency"></info>
				<info appearance-options="üßô‚Äç‚ôÇÔ∏è üßô‚Äç‚ôÄÔ∏è"></info>
				<merchant bp="artificer"></merchant>
			</visitor-blueprint>

			<visitor-blueprint name="apothecary">
				<info frequency="6" on-join-fn="Visitors.HalfFrequency" on-skip-fn="Visitors.PlusOneFrequency"></info>
				<info appearance-options="üë®‚Äç‚öïÔ∏è üë©‚Äç‚öïÔ∏è"></info>
				<merchant bp="apothecary"></merchant>
			</visitor-blueprint>

			<visitor-blueprint name="mysterious_stranger">
				<info frequency="1" on-join-fn="Visitors.ZeroFrequency" ></info>
				<info>
					<name-opt value="Mysterious Stranger"></name-opt>
				</info>
				<info appearance-options="üòé" extra-classes="mysterious_stranger"></info>
				<merchant>
					<bp>
						<inventory-bp items-for-sale="1">
							<preparation bp="sp_mysteryBox"></preparation>
						</inventory-bp>
					</bp>
				</merchant>
			</visitor-blueprint>


			<!-- Merchant blueprints -->
			<merchant-blueprint name="soldier">
				<inventory-bp items-for-sale="3">
					<preparation bp="barricade"></preparation>
					<preparation bp="throwingknife"></preparation>
					<preparation bp="fireBomb"></preparation>
					<preparation bp="iceBomb"></preparation>
					<preparation bp="windBomb"></preparation>
					<preparation bp="earthBomb"></preparation>
				</inventory-bp>
			</merchant-blueprint>

			<merchant-blueprint name="artificer">
				<inventory-bp items-for-sale="3">
					<preparation bp="blinkCrystal"></preparation>
					<preparation bp="retreatCloak"></preparation>
					<preparation bp="fireBomb"></preparation>
					<preparation bp="iceBomb"></preparation>
					<preparation bp="windBomb"></preparation>
					<preparation bp="earthBomb"></preparation>
				</inventory-bp>
			</merchant-blueprint>

			<merchant-blueprint name="apothecary">
				<inventory-bp items-for-sale="3">
					<preparation bp="minorDamagePot"></preparation>
					<preparation bp="minorDefensePot"></preparation>
					<preparation bp="turtlePot"></preparation>
					<preparation bp="cheetahPot"></preparation>
				</inventory-bp>
			</merchant-blueprint>
		</concept>

		<concept hash="cards">
			<info-panel>
				<h2> Cards </h2>
				Cards!  I should say more about cards.
			</info-panel>

			<concept hash="card">
				<info-panel>
					<h2> Card </h2>
					<p>You play these when combat is paused.</p>
					<p>If the card is blinking and very slightly see-through, it's an ephemeral card: It only exists during this battle, and will be removed from your deck once the battle completes.</p> 
				</info-panel>
			</concept>
			
			<concept hash="drawpile">
				<info-panel>
					<h2> Draw Pile </h2>
					When you draw cards, they from from this pile.  You don't know what order they are in by default, but you know how many there are.

					You can draw additional cards by clicking the draw pile, but it will cost you money.
				</info-panel>
			</concept>

			<concept hash="discard">
				<info-panel>
					<h2> Discard Pile </h2>
					When you play a card, unless it goes somewhere else, it goes here.

				</info-panel>
			</concept>
		</concept>

		<concept hash="skills">
			<info-panel>
				<h2> Skills </h2>
				<p>Units use these to do things during their <span compendium="concept/unit/concept/activation">activations</span>.</p>

				<p>To read a <span hover-help="[wt~=Card] [wt~=Ability]">skill on a card</span>:<ul>
					<li>Upper-left Icon: Ignore this icon for now.  This is the skill slot's type, which is for a future planned feature.</li>
					<li>Bottom-left Icon: Ignore this icon for now.  This is the skill's category, which is for a future planned feature.</li>
					<li>Hourglass: The left number is what the starting cooldown is when the unit is placed.  The right number is what the cooldown resets to after use.</li>
					<li>Icon + Name right of Hourglass:  The skill's icon and name.</li>
					<li><span compendium="concept/unit/concept/activation">Activation</span>: When the skill can be used.</li>
				</ul></p>
				<p>At the time of writing, the following skills exist:
					<ul>
						<li>Strike: Basic attack.  Rats do 2 damage.  Player units do 8 (+2 per combo).</li>
						<li>Step: Move 1 (+1 per combo, +1 per <span compendium="concept/status">üí® stack</span>.  If the unit can't move, add 1 <span compendium="concept/status">üí® stack</span>.  While it benefits from combos, it does not contribute to them.</li>
						<li>Retreat: Remove 1 <span compendium="concept/status">üè≥Ô∏è stack</span> stack.  While it benefits from combos, it does not contribute to them.</li>
						<li>Wind Blast: Attempts to push a unit backward within their cell block.  How far a unit is moved is based on how heavy the unit is, and the strength of the push.  Units that collide may take damage.</li>
						<li>Shove: Same as Wind Blast, but in a different row.</li>
						<li>Defend: Gain <span compendium="concept/block">block</span>.</li>
						<li>Protect: The adjecent ally (or self) with the lowest HP gains <span compendium="concept/block">block</span>.  If this affects a different unit, more block is gained.</li>
						<li>Bleed: Add 6 stacks of Bleed to an enemy.  Enemies lose HP (bypassing Block) equal to the number of Bleed stacks they have and lose half their bleed stacks every time the unit is activated.</li>
						<li>Sunder: Remove a large amount of block, then apply <span compendium="concept/block">vulnerability</span>.</li>
						<li>Distract: Adds 2 stacks of Distract to an enemy.  Each stack causes the enemy's abilities to activate on a later volley.  Enemies lose 1 stack of Distract every time they are activtaed.</li>
					</ul>
				</p>


				<!-- Skill Refactor Starts Here -->
				<move-blueprint name="punch">
					<appearance move_icon="‚úä"></appearance>
					<target-mode target-type="hostile" target-mode="AT"></target-mode>
					<info invoke-fn="AttackMove.invoke"></info>
				</move-blueprint>

				<move-blueprint name="strike">
					<appearance move_icon="‚öîÔ∏è"></appearance>
					<target-mode target-type="hostile" target-mode="AT"></target-mode>
					<target-mode target-type="hostile" target-mode="SZ"></target-mode>
					<target-mode target-type="hostile" target-mode="AZ" effective-from="F1 F2 F3"></target-mode>
					<info invoke-fn="AttackMove.invoke" resolve-target-fn="MoveUtils.MeleeTarget"></info>	
				</move-blueprint>

				<move-blueprint name="shoot">
					<bp>
						<appearance move_icon="üèπ"></appearance>
						<!-- TODO: Figure out how to configure being able to bypass a barricade. -->
						<target-mode target-type="hostile" target-mode="AZ" effective-from="M1 M2 M3"></target-mode>
						<info invoke-fn="AttackMove.invoke"></info>	
					</bp>
				</move-blueprint>

				<move-blueprint name="step">
					<appearance move_icon="ü•æ"></appearance>
					<!-- Not active if the destination has been reached.  -->
					<active-mode active-fn="MoveUtils.UserNotInTargetLocation"></active-mode>
					<target-mode target-type="self"></target-mode>
					<info invoke-fn="StepMove.invoke"></info>
				</move-blueprint>

				<move-blueprint name="flee">
					<appearance move_icon="üè≥Ô∏è"></appearance>
					<!-- Not active if the unit isn't on an escapable square  -->
					<active-mode active-fn="MoveUtils.UserInMatchingTeamCell" cell-selector="[tag~=escape]"></active-mode>
					<target-mode target-type="self"></target-mode>
					<info invoke-fn="RetreatMove.invoke"></info>
				</move-blueprint>

				<!-- Movesets (temporary: these should be on weapons!) -->
				<move-slot-gen name="sharp_stick">
					<bp>
						<appearance moveset_name="Sharp Stick"></appearance>
					</bp>
					<gen>
						<copyDest moveset_name="Sharp Stick"></copyDest>
						<setMoves>
							<move-gen bp="strike">
								<priority value="0"></priority>
							</move-gen>
						</setMoves>
					</gen>
				</move-slot-gen>

				<move-slot-gen name="rocks">
					<bp>
						<description>Bash an adjacent enemy with a rock, otherwise throw one at a further enemy.</description>
					</bp>
					<gen>
						<copyDest moveset_name="Rocks"></copyDest>
						<setMoves>
							<move-gen bp="punch">
								<priority value="0"></priority>
							</move-gen>
							<move-gen bp="shoot">
								<priority value="-1"></priority>
							</move-gen>
						</setMoves>
					</gen>
				</move-slot-gen>

				<!-- Moveset: This is what humans start with. -->
				<move-slot-gen name="base_human">
					<bp>
						<appearance moveset_name="Fists"></appearance>
					</bp>
					<gen>
						<copyDest moveset_name="Fists"></copyDest>
						<setMoves>
							<move-gen bp="punch">
								<priority value="0"></priority>
							</move-gen>
						</setMoves>
					</gen>
				</move-slot-gen>

				<!-- Legacy Skill Data, Delete When Replaced -->

				<!-- Standard param functions.  -->
				<skill-param-fn type="‚öîÔ∏è" fn="SkillParams.MeleeParams"></skill-param-fn>
				<skill-param-fn type="‚öæ" fn="SkillParams.ThrownParams"></skill-param-fn>
				<skill-param-fn type="üèπ" fn="SkillParams.ShootParams"></skill-param-fn>
				<skill-param-fn type="‚òÑÔ∏è" fn="SkillParams.MAttackParams"></skill-param-fn>
				<skill-param-fn type="üõ°Ô∏è" fn="SkillParams.DefendParams"></skill-param-fn>
				<skill-param-fn type="üî®" fn="SkillParams.ConstructParams"></skill-param-fn>
				<skill-param-fn type="üîÆ" fn="SkillParams.SummonParams"></skill-param-fn>
				<skill-param-fn type="ü§≤" fn="SkillParams.PushParams"></skill-param-fn>
				<skill-param-fn type="ü•æ" fn="SkillParams.MoveParams"></skill-param-fn>
				<skill-param-fn type="‚ú®" fn="SkillParams.BuffParams"></skill-param-fn>
				<skill-param-fn type="üí´" fn="SkillParams.DebuffParams"></skill-param-fn>
				<skill-param-fn type="üè≥Ô∏è" fn="SkillParams.RetreatParams"></skill-param-fn>

				<skill-blueprint name="strike" label="Strike" short-label="‚öîÔ∏è" type="‚öîÔ∏è" invoke-fn="Strike.strikeInvoke" target-fn="Targeting.StandardEnemy" target-travel="walk" param-fn="SkillParams.Standard" receives-combo="true" gives-combo="true"  active-in-fn="ActiveIn.Standard" active-in="F1 F2 F3 CC">
					<combo-effect priority="0" cost-fn="Mana.CostsAllMana" param-fn="Strike.combo"></combo-effect>
				</skill-blueprint>

				<skill-blueprint name="throw" label="Throw" short-label="‚öæ" type="‚öæ" invoke-fn="Strike.throwInvoke" target-fn="Targeting.StandardEnemy" target-travel="line" param-fn="SkillParams.Standard" receives-combo="true" gives-combo="true" active-in-fn="ActiveIn.Standard" active-in="M1 M2 M3 CC">
					<combo-effect priority="0" cost-fn="Mana.CostsAllMana" param-fn="Strike.combo"></combo-effect>
				</skill-blueprint>

				<skill-blueprint name="shoot" label="Shoot" short-label="üèπ" type="üèπ" invoke-fn="Strike.shootInvoke" target-fn="Targeting.StandardEnemy" target-travel="line" target-overhead="true" param-fn="SkillParams.Standard" receives-combo="true" gives-combo="true" active-in-fn="ActiveIn.Standard" active-in="B1 B2 B3 CC">
					<combo-effect priority="0" cost-fn="Mana.CostsAllMana" param-fn="Strike.combo"></combo-effect>
				</skill-blueprint>

				<skill-blueprint name="push" label="Shove" short-label="ü§≤" type="ü§≤" invoke-fn="Push.invoke" target-fn="Targeting.StandardEnemy" target-travel="walk" param-fn="SkillParams.Standard" receives-combo="true" gives-combo="true" active-in-fn="ActiveIn.Standard" active-in="F1 F2 F3">
					<combo-effect priority="0" cost-fn="Mana.CostsAllMana" param-fn="Push.combo"></combo-effect>
				</skill-blueprint>

				<skill-blueprint name="wind-gust" label="Wind Gust" short-label="üå¨Ô∏è" type="ü§≤" invoke-fn="Push.invoke" target-fn="Targeting.StandardEnemy" target-travel="line" param-fn="SkillParams.Standard" receives-combo="true" gives-combo="true" active-in-fn="ActiveIn.Standard" active-in="B1 B2 B3">
					<combo-effect priority="0" cost-fn="Mana.CostsAllMana" param-fn="Push.combo"></combo-effect>
				</skill-blueprint>

				<skill-blueprint name="defend" label="Defend" short-label="üõ°Ô∏è" type="üõ°Ô∏è" invoke-fn="Defend.invoke" target-fn="Targeting.StandardSelf" param-fn="SkillParams.Standard" receives-combo="true" gives-combo="true" active-in-fn="ActiveIn.Standard" active-in="F1 F2 F3 M1 M3 B1 B2 B3 CC">
					<combo-effect priority="0" cost-fn="Mana.CostsAllMana" param-fn="Defend.combo"></combo-effect>
				</skill-blueprint>

				<skill-blueprint name="protect" label="Protect" short-label="üõ°Ô∏è" type="üõ°Ô∏è" invoke-fn="Protect.invoke" target-fn="Targeting.StandardSelf" param-fn="SkillParams.Standard" extra-param-types="‚ú®" receives-combo="true" gives-combo="true" active-in-fn="ActiveIn.Standard" active-in="F2 M1 M2 M3 B2 CC">
					<combo-effect priority="0" cost-fn="Mana.CostsAllMana" param-fn="Protect.combo"></combo-effect>
				</skill-blueprint>

				<skill-blueprint name="bleed" label="Bleed" short-label="ü©∏" type="üí´" invoke-fn="BleedAbility.invoke" target-fn="Targeting.StandardEnemy" target-travel="walk" param-fn="SkillParams.Standard" extra-param-types="‚öîÔ∏è" receives-combo="true" gives-combo="true" active-in-fn="ActiveIn.Standard" active-in="F1 F2 F3 CC">
					<combo-effect priority="0" cost-fn="Mana.CostsAllMana" param-fn="BleedAbility.combo"></combo-effect>
				</skill-blueprint>

				<skill-blueprint name="sunder" label="Sunder" short-label="üíî" type="üí´" invoke-fn="SunderAbility.invoke" target-fn="Targeting.StandardEnemy" target-travel="walk" param-fn="SkillParams.Standard" extra-param-types="‚öîÔ∏è" receives-combo="true" gives-combo="true" active-in-fn="ActiveIn.Standard" active-in="F1 F2 F3 CC">
					<combo-effect priority="0" cost-fn="Mana.CostsAllMana" param-fn="SunderAbility.combo"></combo-effect>
				</skill-blueprint>

				<skill-blueprint name="distract" label="Distract" short-label="üí´" type="üí´" invoke-fn="DistractAbility.invoke" target-fn="Targeting.StandardEnemy" target-travel="line" param-fn="SkillParams.Standard" receives-combo="true" gives-combo="true" active-in-fn="ActiveIn.Standard" active-in="M1 M2 M3 CC">
					<combo-effect priority="0" cost-fn="Mana.CostsAllMana" param-fn="DistractAbility.combo"></combo-effect>
				</skill-blueprint>

				<!-- Skills that happen because of orders or whatever. -->
				<skill-blueprint name="retreat" label="Retreat" short-label="üè≥Ô∏è" type="üè≥Ô∏è" invoke-fn="RetreatAbility.invoke" target-fn="Targeting.StandardSelf" param-fn="SkillParams.Standard" receives-combo="true" gives-combo="false" active-in-fn="ActiveIn.Standard" active-in="F1 F2 F3 M1 M2 M3 B1 B2 B3">
					<combo-effect priority="0" cost-fn="Mana.CostsAllMana" param-fn="RetreatAbility.combo"></combo-effect>
				</skill-blueprint>

				<skill-blueprint name="step" label="Step" short-label="ü•æ" type="ü•æ" invoke-fn="StepAbility.invoke" target-fn="Targeting.StandardSelf" param-fn="SkillParams.Standard" receives-combo="true" gives-combo="false" active-in-fn="ActiveIn.Standard" active-in="AA CC F1 F2 F3 M1 M2 M3 B1 B2 B3">
					<combo-effect priority="0" cost-fn="Mana.CostsAllMana" param-fn="StepAbility.combo"></combo-effect>
				</skill-blueprint>

				<skill-blueprint name="struggle" label="Struggle" short-label="‚ùì" type="‚ùì" invoke-fn="Strike.struggleInvoke" target-fn="Targeting.StandardEnemy" param-fn="SkillParams.Standard" receives-combo="false" gives-combo="false" active-in-fn="ActiveIn.Standard" active-in="CC">
				</skill-blueprint>

				<!-- Enemy-only skill blueprints -->

				<!-- Anyone who needs to move to a destination -->
				<skill-blueprint name="scurry" label="Scurry" short-label="ü•æ" type="ü•æ" invoke-fn="ScurryAbility.invoke" target-fn="Targeting.StandardSelf" param-fn="SkillParams.Standard" receives-combo="false" gives-combo="false" active-in-fn="ActiveIn.Standard" active-in="AA F1 F2 F3 M1 M2 M3 B1 B2 B3">
				</skill-blueprint>

				<!-- Golems -->
				<skill-blueprint name="mindlessmarch" label="Mindless March" short-label="ü•æ" type="ü•æ" invoke-fn="MindlessMarch.invoke" target-fn="Targeting.StandardSelf" param-fn="SkillParams.Standard" receives-combo="false" gives-combo="false" active-in-fn="ActiveIn.Standard" active-in="M1 M2 M3 B1 B2 B3">
				</skill-blueprint>
				
				<!-- Jimmy the Rat King -->
				<skill-blueprint name="rat-redirect" label="That one's scary!" short-label="üéØ" type="üõ°Ô∏è" invoke-fn="JimmyAI.redirectInvoke" target-fn="Targeting.StandardSelf" param-fn="SkillParams.Standard" receives-combo="true" gives-combo="true" active-in-fn="ActiveIn.Standard" active-in="F1 F2 F3 M1 M2 M3 B1 B2 B3">
				</skill-blueprint>
				
				<skill-blueprint name="summon-rats" label="Come my pretties!" short-label="üêÄ" type="üîÆ" invoke-fn="JimmyAI.summonInvoke" target-fn="Targeting.StandardSelf" param-fn="SkillParams.Standard" receives-combo="true" gives-combo="true" active-in-fn="ActiveIn.Standard" active-in="F1 F2 F3 M1 M2 M3 B1 B2 B3" cooldown-duration="12">
				</skill-blueprint>

				<!-- Bug skills. -->
				<skill-blueprint name="bug_spit_web" label="Spit Web" short-label="üï∏Ô∏è" type="üí´" invoke-fn="BugEnemy.SpitWeb" target-fn="Targeting.StandardEnemy" param-fn="SkillParams.Standard" receives-combo="true" gives-combo="true" active-in-fn="ActiveIn.Standard" active-in="M1 M2 M3 B1 B2 B3"></skill-blueprint>

				<!-- Generic enemy skills. -->
				<skill-blueprint name="str_gain" label="Buff!" short-label="üí™" type="‚ú®" amount="1" status="base_damage" invoke-fn="GenericMoves.AddStatus" target-fn="Targeting.StandardSelf" param-fn="SkillParams.Standard" receives-combo="false" gives-combo="false" active-in-fn="ActiveIn.Standard" active-in="AA CC F1 F2 F3 M1 M2 M3 B1 B2 B3"></skill-blueprint>

			</info-panel>
		</concept>

		<concept hash="preparations">
			<info-panel renderer="Compendiums.RenderPreparation">
				<h2>Preparations</h2>

				<p>Preparations are cards that you can play to create instant efects on the battlefield.  They're a way that you can trade money for immediate efficacy.</p>
				<p>Preparations always cost money and have a limited number of uses in combat: <ul>
					<li>‚úîÔ∏è: This icon means 1 available use that becomes ‚ùå once used. </li>
					<li>‚ùå: This icon means 1 unavailable use that becomes ‚úîÔ∏è after the combat. </li>
					<li>üî¥: This icon means 1 available use that will never be restored once used.</li>					
					<li>üéÅ: If you use it, this card will transform into something new!</li>					
				</ul></p>
				<p>If the card has no available uses (all ‚ùå), it's removed from the combat, but will be put back in the owning unit's inventory after combat.</p>
				<p>If the card has no available uses because they were all üî¥, the card is gone forever.  Go buy more, when that's implemented.  Use those firebombs wisely.</p>

				<template>
					<p>Right-click <span compendium="concept/preparations">here for the base page on Preparations.</span></p>
					<div class="compendium_view">

					</div>
				</template>
			</info-panel>

			<!-- Left here for reference. -->
			<starting-preparation count="0">
				<!--
				<preparation bp="barricade"></preparation>
				<preparation bp="minorDamagePot"></preparation>
				<preparation bp="throwingknife"></preparation>
				<preparation bp="turtlePot"></preparation>
				<preparation bp="cheetahPot"></preparation>
				<preparation bp="minorDefensePot"></preparation>
				<preparation bp="blinkCrystal"></preparation>
				<preparation bp="fireBomb"></preparation>
				<preparation bp="retreatCloak"></preparation> -->
			</starting-preparation>
			
			<starting-preparation count="0"> <!-- Debug item test. -->
				<preparation bp="sp_mysteryBox"></preparation>
			</starting-preparation>

			<preparation-mode name="default" init-fn="Preparations.InitDefaultMode"></preparation-mode>
			<preparation-mode name="degrade" init-fn="Preparations.InitDegradeMode"></preparation-mode>
			<preparation-mode name="exhaust" init-fn="Preparations.InitExhaustMode"></preparation-mode>
			<preparation-mode name="gift" init-fn="Preparations.InitGiftMode"></preparation-mode>

			<preparation-use-type name="default" on-use-fn="Preparations.OnDefaultUse"></preparation-use-type>
			<preparation-use-type name="exhaust" on-use-fn="Preparations.OnExhaustUse"></preparation-use-type>
			<preparation-use-type name="gift" on-use-fn="Preparations.OnGiftUse"></preparation-use-type>

			<preparation-blueprint name="barricade" target-fn="Barricade.target" invoke-fn="Barricade.invoke">
				<div label="Barricade" appearance_1="üß±"></div>
				<div class="description">Drops a barricade onto the battlefield.  Barricades can be used to block cells, which affects targeting.</div>
				<div cost="3" uses="5" mode="degrade"></div>
			</preparation-blueprint>

			<preparation-blueprint name="throwingknife" target-fn="Preparations.FrontEnemyInAdjacentBlockTarget" invoke-fn="OffensiveItems.throwingKnife">
				<div label="Throwing Knife" appearance_1="üó°Ô∏è"></div>
				<div class="description">Deals 5 damage to one of the front-most enemies in a block adjacent to your units.</div>
				<div cost="1" uses="3"></div>
			</preparation-blueprint>

			<preparation-blueprint name="minorDamagePot" target-fn="Preparations.AllyUnitTarget" invoke-fn="BuffPotions.minorBaseDamage">
				<div label="Bull Potion" appearance_1="üß™" appearance_2="üêÇ"></div>
				<div class="description">Increases damage dealt by your unit's ‚öîÔ∏è‚öæüèπ skills by 3.</div>
				<div cost="0" uses="1" mode="exhaust"></div>
			</preparation-blueprint>

			<preparation-blueprint name="minorDefensePot" target-fn="Preparations.AllyUnitTarget" invoke-fn="BuffPotions.minorBaseDefense">
				<div label="Bear Potion" appearance_1="üß™" appearance_2="üêª"></div>
				<div class="description">Increases defense gained by your unit's üõ°Ô∏è skills by 3.</div>
				<div cost="0" uses="1" mode="exhaust"></div>
			</preparation-blueprint>

			<preparation-blueprint name="turtlePot" target-fn="Preparations.AllyUnitTarget" invoke-fn="BuffPotions.turtlePotion">
				<div label="Turtle Soup" appearance_1="ü•£" appearance_2="üê¢"></div>
				<div class="description">Increase cooldowns on all your skills by 2.  Gain 15 üõ°Ô∏è.</div>
				<div cost="0" uses="2" mode="exhaust"></div>
			</preparation-blueprint>

			<preparation-blueprint name="cheetahPot" target-fn="Preparations.AllyUnitTarget" invoke-fn="BuffPotions.cheetahPotion">
				<div label="Cheetah Soup" appearance_1="ü•£" appearance_2="üêÜ"></div>
				<div class="description">Decrease cooldowns on all your skills to 1.</div>
				<div cost="0" uses="2" mode="exhaust"></div>
			</preparation-blueprint>

			<preparation-blueprint name="blinkCrystal" target-fn="BlinkCrystal.TargetFn" invoke-fn="BlinkCrystal.invoke">
				<div label="Blink Crystal" appearance_1="üíé" appearance_2="üßø"></div>
				<div class="description">Teleport a unit to a space in the same cell block.</div>
				<div cost="3" uses="3" mode="degrade"></div>
			</preparation-blueprint>

			<preparation-blueprint name="fireBomb" target-fn="Preparations.AdjacentEnemyBlockCellTarget" invoke-fn="OffensiveItems.fireBomb">
				<div label="Fire Bomb" appearance_1="üí£" appearance_2="üî•"></div>
				<div class="description">Deal 30 damage to enemies in a cell and the 4 adjacent cells around them within their block.</div>
				<div cost="0" uses="1" mode="exhaust"></div>
			</preparation-blueprint>

			<preparation-blueprint name="iceBomb" target-fn="Preparations.AdjacentEnemyBlockCellTarget" invoke-fn="OffensiveItems.iceBomb">
				<div label="Ice Bomb" appearance_1="üí£" appearance_2="üíß"></div>
				<div class="description">Deal 15 damage to enemies in a cell and the 4 adjacent cells around them within their block and delays their actions by 6 volleys.</div>
				<div cost="0" uses="1" mode="exhaust"></div>
			</preparation-blueprint>

			<preparation-blueprint name="windBomb" target-fn="Preparations.AdjacentEnemyBlockCellTarget" invoke-fn="OffensiveItems.windBomb">
				<div label="Gust Bomb" appearance_1="üí£" appearance_2="üå™Ô∏è"></div>
				<div class="description">Enemies in the same cell block adjacent to the chosen cell are pushed away from the chosen cell.</div>
				<div cost="0" uses="1" mode="exhaust"></div>
			</preparation-blueprint>

			<preparation-blueprint name="earthBomb" target-fn="Preparations.AdjacentEnemyBlockCellTarget" invoke-fn="OffensiveItems.earthBomb">
				<div label="Pebble Bomb" appearance_1="üí£" appearance_2="‚õ∞Ô∏è"></div>
				<div class="description">Applies 45 vulnerability to enemies in a cell and the 4 adjacent cells around them within their block.</div>
				<div cost="0" uses="1" mode="exhaust"></div>
			</preparation-blueprint>

			<preparation-blueprint name="retreatCloak" target-fn="Preparations.AllyUnitTarget" invoke-fn="DefensiveItems.instantRetreat">
				<div label="Raven Hat" appearance_1="üé©" appearance_2="üê¶"></div>
				<div class="description">A selected unit immediately retreats from the battlefield.</div>
				<div cost="0" uses="3" mode="exhaust"></div>
			</preparation-blueprint>
			
			<preparation-blueprint name="sp_bombBag" target-fn="Preparations.Owner" invoke-fn="SpecialItems.bombBag">
				<div label="Bomb Bag" appearance_1="üëú" appearance_2="üí£"></div>
				<div class="description">Must be played on its owner.  Create a random bomb card in your hand.</div>
				<div cost="10" uses="3"></div>
			</preparation-blueprint>

			<preparation-blueprint name="sp_mysteryBox" target-fn="Preparations.Owner" invoke-fn="SpecialItems.mysteryBox">
				<div label="Mystery Box" appearance_1="üéÅ" appearance_2="‚ùì"></div>
				<div class="description">Must be played on its owner. Keep using it and maybe you'll get something nice!</div>
				<div cost="5" uses="4" mode="gift"></div>
				<info class="gift">
					<preparation bp="sp_bombBag"></preparation>
				</info>
			</preparation-blueprint>
		</concept>

		<concept hash="tactics">
			<info-panel>
				<h2>Tactics</h2>
				Tactics are cards that direct your units in ways beyond what their abilities allow them to do. 

				<div>
					üìú indicates an Order.  A unit may only be affected by one order at a time, and any new orders will overwrite old orders.
				</div>

				<div>
					üìï indicates a Maneuver.  Maneuvers have no other special properties.
				</div>
			</info-panel>

			<!-- Orders -->
			<tactic-blueprint name="retreat" card-icon="üìú" label="Retreat!" short-label="üè≥Ô∏è" target-fn="Retreat.target" invoke-fn="Retreat.invoke">
				<div class="description">After 3 <span compendium="concept/unit/concept/activation">activations</span>, the unit is removed from the battlefield and placed to your discard pile.</div>
			</tactic-blueprint>
			
			<tactic-blueprint name="reposition" card-icon="üìú" label="Reposition!" short-label="ü•æ" target-fn="Reposition.target" invoke-fn="Reposition.invoke">
				<div class="description">During each activation, move towards the chosen location until it is reached or inaccessible.</div>
			</tactic-blueprint>

			<tactic-blueprint name="taunt-enemy" card-icon="üìú" label="Hit That One!" short-label="üéØ" target-fn="TauntEnemy.target" invoke-fn="TauntEnemy.invoke">
				<div class="description">Choose an enemy.  That enemy is <span compendium="concept/taunt">taunted.</span></div>
			</tactic-blueprint>

			<tactic-blueprint name="taunt-ally" card-icon="üìú" label="Hit Me!" short-label="üó£Ô∏è" target-fn="TauntAlly.target" invoke-fn="TauntAlly.invoke">
				<div class="description">Choose an ally.  That ally is <span compendium="concept/taunt">taunted.</span></div>
			</tactic-blueprint>
			
			<tactic-blueprint name="go-faster" card-icon="üìú" label="Hustle!" short-label="üó£Ô∏è" target-fn="Hustle.target" invoke-fn="Hustle.invoke">
				<div class="description">Subtract 1 from all of an ally's current ability cooldowns if they are above 1.</span></div>
			</tactic-blueprint>
			
			<tactic-blueprint name="go-slower" card-icon="üìú" label="Wait for it!" short-label="üó£Ô∏è" target-fn="WaitForIt.target" invoke-fn="WaitForIt.invoke">
				<div class="description">Add 1 to all of an ally's current ability cooldowns.</span></div>
			</tactic-blueprint>

			<!-- Maneuvers -->
			<tactic-blueprint name="pivot" card-icon="üìï" label="Heel Turn" short-label="‚¶©" target-fn="Pivot.target" invoke-fn="Pivot.invoke">
				<div class="description">Changes which way a squad is facing.</div>
			</tactic-blueprint>

			<!-- Situational -->
			<tactic-blueprint name="march" card-icon="üìï" label="March" short-label="üö∂" target-fn="March.target" invoke-fn="March.invoke">
				<div class="description">Direct all your units in one cell block to move to an adjacent empty cell block.</div>
			</tactic-blueprint>

		</concept>

		<concept hash="unit">

			<silly-unit matcher="üôÉüî•üåì" name="Hammad"></silly-unit>
			<silly-unit matcher="üòµüî•üåì" name="Nikki"></silly-unit>
			<silly-unit matcher="üò¥‚õ∞Ô∏èüåì" name="Chris"></silly-unit>
			<silly-unit matcher="üôÉüå™Ô∏èüåñ" name="Jill"></silly-unit>
			<silly-unit matcher="üò¨‚õ∞Ô∏èüåí" name="Jake"></silly-unit>
			<silly-unit matcher="ü§†üå™Ô∏èüåí" name="Ryan"></silly-unit>
			<silly-unit matcher="ü§†üî•üåî" name="Ryan"></silly-unit>
			<silly-unit matcher="üò±üíßüåì" name="Fiona"></silly-unit>
			<silly-unit matcher="üßêüíßüåò" name="Drewes"></silly-unit>
			<silly-unit matcher="üò¨üî•üåë" name="Kellie"></silly-unit>
			<silly-unit matcher="üê±üíßüåë" name="Robin"></silly-unit>

			<!-- Used by PlayerUnits to generate our big canonical ordered list of face-month-days for picking units. -->
			<player-demographics>
				<def alias="appearance" values="ü§© üòó üòÄ üòÅ ü§£ üôÉ üòâ üòú ü§ë ü§ê üòë üò¨ üò¥ ü§Æ üòµ ü§† ü§ì üßê üò± üê±"></def>
				<def alias="month" values="üî• üå™Ô∏è üíß ‚õ∞Ô∏è"></def>
				<def alias="day" values="üåñ üåó üåò üåë üåí üåì üåî üåï"></def>
				<template name="demographic">
					<player-demographic></player-demographic>
				</template>
			</player-demographics>

			<info-panel renderer="Compendiums.RenderUnit">
				<h2>Unit</h2>

				<p>Units are the folks who bash eachother until they stop moving.  Your units are either on the field (on a grid) or stuck in a <span compendium="concept/cards">card</span>.</p>
				<p>You play units from cards onto the battlefield.  When units retreat, they return to your <span compendium="concept/cards/concept/discard">discard pile</span>.</p>
				<p>Units have Hit Points, represented by a bar below them.  When this bar is empty, the unit is dead: gone forever!</p>
				<p>Player units have Birthdays, represented by the other icons in their avatar bubble.  These determine how the units <span compendium="concept/unit/concept/combo">combo</span> together.</p>

				<template>
					<h2>Unit Details</h2>
					<p>Right click <span compendium="concept/unit">here for the main page on units in general.</span></p>
					<div class="exploded_cards" facing="up">
						<div class="card unit_container">

						</div>
					</div>
				</template>				
			</info-panel>

			<!-- Hero Units for V2 -->
			<unit-blueprint name="base_human">
				<appearance appearance="üôÇ" month="‚ùì" day="‚ùì"></appearance>
				<base-stats damage="8" defense="6" cunning="2" move="1" mass="8" hp="40"></base-stats>
				<has-inventory max-items="2"></has-inventory>>
				<has-combos max-items="2"></has-combos>
			</unit-blueprint>

			<unit-gen name="protagonist_unit" base="base_human">
				<def key="name" value="Protagonist"></def>
				<setName def="name"></setName>
				<copy protagonist="true" team="player"></copy>
				<!-- TODO: Other things to make the protagonist special. -->	
			</unit-gen>

			<unit-gen name="random_human" base="base_human">
				<sub name="name" selector="unit-gen[name='name_human']"></sub>
			</unit-gen>

			<unit-gen name="random_teammate" base="random_human">
				<copy team="player"></copy>
			</unit-gen>

			<unit-gen name="base_human" bp="base_human">
				<def key="rng" fn="UnitGen.getRng"></def>
				<def key="face" fn="PlayerUnits.TakeDemographic" params="rng"></def> <!-- Grabs a face/month/day from our set of available options. -->
				<!-- Separate function to set the month, day, avatar from the "face" alias -->
				<invoke fn="PlayerUnits.ApplyDemographic" params="face"></invoke>

				<!-- Pick a move slot. Humans favor 4/5 over 3/6.-->
				<choose choices="3 4 4 4 5 5 5 6">
					<result value="3"><def key="moveslot" value="3"></def></result>
					<result value="4"><def key="moveslot" value="4"></def></result>
					<result value="5"><def key="moveslot" value="5"></def></result>
					<result value="6"><def key="moveslot" value="6"></def></result>
				</choose>

				<copyDef mod-tags="moveslot"></copyDef>
				<addMoveSlot>
					<bp>
						<appearance moveset_name="Fists"></appearance>
					</bp>
					<gen>
						<copy default="sharp_stick"></copy>
						<copyDest moveset_name="Fists"></copyDest>
						<copy slot-type="‚òùÔ∏è"></copy>
						<copyDest cooldown-duration="8"></copyDest>
						<copyDestDef warmup-time="moveslot" current-cooldown="moveslot"></copyDestDef>
					</gen>
				</addMoveSlot>
			</unit-gen>

			<unit-gen name="name_human">
				<!-- Select a name, which might be from our easter eggs.-->
				<choose fn="PlayerUnits.DemographicString">
					<result value="üôÉüî•üåì">						
						<def key="name" value="Hammad"></def>
					</result>
					<result value="üòµüî•üåì">
						<def key="name" value="Nikki"></def>
					</result>
					<result value="üò¥‚õ∞Ô∏èüåì"">
						<def key="name" value="Chris"></def>
					</result>
					<result value="üôÉüå™Ô∏èüåñ">
						<def key="name" value="Jill"></def>
					</result>
					<result value="üò¨‚õ∞Ô∏èüåí">
						<def key="name" value="Jake"></def>
					</result>
					<result value="ü§†üå™Ô∏èüåí">
						<!-- Mountains'n'Climbin Ryan -->
						<def key="name" value="Ryan"></def>
					</result>
					<result value="ü§†üî•üåî">
						<!-- Graphics'n'Work Ryan -->
						<def key="name" value="Ryan"></def>
					</result>
					<result value="üò±üíßüåì">
						<def key="name" value="Fiona"></def>
					</result>
					<result value="üßêüíßüåò">
						<def key="name" value="Drewes"></def>
					</result>
					<result value="üò¨üî•üåë">
						<def key="name" value="Kellie"></def>
					</result>
					<result value="üê±üíßüåë">
						<def key="name" value="Robin"></def>
					</result>
					<result default="true">
						<def key="name" fn="PlayerUnits.TakeName" params="rng"></def>
					</result>
				</choose>
				<setName def="name"></setName>
			</unit-gen>


			<!-- ENEMY GEN GOES HERE -->
			<unit-gen name="deer">
				<bp>
					<appearance appearance="ü¶å"></appearance>
					<base-stats damage="6" defense="4" cunning="1" move="1" mass="12" hp="30"></base-stats>	
				</bp>
				<gen>
					<choose choices="1 2 3 4">
						<result value="1"><def key="moveslot" value="1"></def></result>
						<result value="2"><def key="moveslot" value="2"></def></result>
						<result value="3"><def key="moveslot" value="3"></def></result>
						<result value="4"><def key="moveslot" value="4"></def></result>
					</choose>
	
					<copyDef mod-tags="moveslot"></copyDef>
					<addMoveSlot>
						<bp>
							<appearance moveset_name="Travel"></appearance>
						</bp>
						<gen>
							<add tag="basic"></add>"
							<copyDest cooldown-duration="8"></copyDest>
							<copyDestDef warmup-time="moveslot" current-cooldown="moveslot"></copyDestDef>
							<setMoves>
								<move-gen bp="step">
									<priority value="0"></priority>
								</move-gen>
								<move-gen bp="flee">
									<priority value="-1"></priority>
								</move-gen>
							</setMoves>
						</gen>
					</addMoveSlot>
				</gen>
			</unit-gen>


	





			<!-- Basic for all enemies as options.  -->
			<unit-mod-group for="generic_enemies">
				<unit-mods group="enemy_scurry">
					<unit-mod mod-tags="1"><slot ordinal="1" type="‚≠ê"><skill bp="scurry"></skill></slot></unit-mod>
					<unit-mod mod-tags="2"><slot ordinal="2" type="‚≠ê"><skill bp="scurry"></skill></slot></unit-mod>
					<unit-mod mod-tags="3"><slot ordinal="3" type="‚≠ê"><skill bp="scurry"></skill></slot></unit-mod>
					<unit-mod mod-tags="4"><slot ordinal="4" type="‚≠ê"><skill bp="scurry"></skill></slot></unit-mod>
					<unit-mod mod-tags="5"><slot ordinal="5" type="‚≠ê"><skill bp="scurry"></skill></slot></unit-mod>
					<unit-mod mod-tags="6"><slot ordinal="6" type="‚≠ê"><skill bp="scurry"></skill></slot></unit-mod>
					<unit-mod mod-tags="7"><slot ordinal="7" type="‚≠ê"><skill bp="scurry"></skill></slot></unit-mod>
					<unit-mod mod-tags="8"><slot ordinal="8" type="‚≠ê"><skill bp="scurry"></skill></slot></unit-mod>
				</unit-mods>
				<unit-mods group="enemy_defend">
					<unit-mod mod-tags="1"><slot ordinal="1" type="‚≠ê"><skill bp="defend"></skill></slot></unit-mod>
					<unit-mod mod-tags="2"><slot ordinal="2" type="‚≠ê"><skill bp="defend"></skill></slot></unit-mod>
					<unit-mod mod-tags="3"><slot ordinal="3" type="‚≠ê"><skill bp="defend"></skill></slot></unit-mod>
					<unit-mod mod-tags="4"><slot ordinal="4" type="‚≠ê"><skill bp="defend"></skill></slot></unit-mod>
					<unit-mod mod-tags="5"><slot ordinal="5" type="‚≠ê"><skill bp="defend"></skill></slot></unit-mod>
					<unit-mod mod-tags="6"><slot ordinal="6" type="‚≠ê"><skill bp="defend"></skill></slot></unit-mod>
					<unit-mod mod-tags="7"><slot ordinal="7" type="‚≠ê"><skill bp="defend"></skill></slot></unit-mod>
					<unit-mod mod-tags="8"><slot ordinal="8" type="‚≠ê"><skill bp="defend"></skill></slot></unit-mod>
				</unit-mods>
				<unit-mods group="enemy_shoot">
					<unit-mod mod-tags="1"><slot ordinal="1" type="‚≠ê"><skill bp="shoot"></skill></slot></unit-mod>
					<unit-mod mod-tags="2"><slot ordinal="2" type="‚≠ê"><skill bp="shoot"></skill></slot></unit-mod>
					<unit-mod mod-tags="3"><slot ordinal="3" type="‚≠ê"><skill bp="shoot"></skill></slot></unit-mod>
					<unit-mod mod-tags="4"><slot ordinal="4" type="‚≠ê"><skill bp="shoot"></skill></slot></unit-mod>
					<unit-mod mod-tags="5"><slot ordinal="5" type="‚≠ê"><skill bp="shoot"></skill></slot></unit-mod>
					<unit-mod mod-tags="6"><slot ordinal="6" type="‚≠ê"><skill bp="shoot"></skill></slot></unit-mod>
					<unit-mod mod-tags="7"><slot ordinal="7" type="‚≠ê"><skill bp="shoot"></skill></slot></unit-mod>
					<unit-mod mod-tags="8"><slot ordinal="8" type="‚≠ê"><skill bp="shoot"></skill></slot></unit-mod>
				</unit-mods>
				<unit-mods group="enemy_strike">
					<unit-mod mod-tags="1"><slot ordinal="1" type="‚≠ê"><skill bp="strike"></skill></slot></unit-mod>
					<unit-mod mod-tags="2"><slot ordinal="2" type="‚≠ê"><skill bp="strike"></skill></slot></unit-mod>
					<unit-mod mod-tags="3"><slot ordinal="3" type="‚≠ê"><skill bp="strike"></skill></slot></unit-mod>
					<unit-mod mod-tags="4"><slot ordinal="4" type="‚≠ê"><skill bp="strike"></skill></slot></unit-mod>
					<unit-mod mod-tags="5"><slot ordinal="5" type="‚≠ê"><skill bp="strike"></skill></slot></unit-mod>
					<unit-mod mod-tags="6"><slot ordinal="6" type="‚≠ê"><skill bp="strike"></skill></slot></unit-mod>
					<unit-mod mod-tags="7"><slot ordinal="7" type="‚≠ê"><skill bp="strike"></skill></slot></unit-mod>
					<unit-mod mod-tags="8"><slot ordinal="8" type="‚≠ê"><skill bp="strike"></skill></slot></unit-mod>
				</unit-mods>
				<unit-mods group="enemy_mindlessmarch">
					<unit-mod mod-tags="1"><slot ordinal="1" type="‚≠ê"><skill bp="mindlessmarch"></skill></slot></unit-mod>
					<unit-mod mod-tags="2"><slot ordinal="2" type="‚≠ê"><skill bp="mindlessmarch"></skill></slot></unit-mod>
					<unit-mod mod-tags="3"><slot ordinal="3" type="‚≠ê"><skill bp="mindlessmarch"></skill></slot></unit-mod>
					<unit-mod mod-tags="4"><slot ordinal="4" type="‚≠ê"><skill bp="mindlessmarch"></skill></slot></unit-mod>
					<unit-mod mod-tags="5"><slot ordinal="5" type="‚≠ê"><skill bp="mindlessmarch"></skill></slot></unit-mod>
					<unit-mod mod-tags="6"><slot ordinal="6" type="‚≠ê"><skill bp="mindlessmarch"></skill></slot></unit-mod>
					<unit-mod mod-tags="7"><slot ordinal="7" type="‚≠ê"><skill bp="mindlessmarch"></skill></slot></unit-mod>
					<unit-mod mod-tags="8"><slot ordinal="8" type="‚≠ê"><skill bp="mindlessmarch"></skill></slot></unit-mod>
				</unit-mods>
			</unit-mod-group>

			<!-- Pill bug -->
			<!-- Left as a complex example -->
			<unit-gen name="pill_bug">
				<unit>
					<bp>
						<appearance appearance="üêõ" name="Bug"></appearance>
						<base-stats damage="2" defense="2" cunning="1" move="1" mass="2" hp="30"></base-stats>	
					</bp>
				</unit>
				<def alias="rng" fn="UnitGen.getRng"></def>				
				<apply-modifier>
					<unit-mod><apply-status status="bug_curl_up" stacks="12"></apply-status></unit-mod>
				</apply-modifier>
				<copy team="enemy"></copy>
				<choose choices="melee range">
					<result value="melee">
						<appearance name="Ragey Poly"></appearance>
						<apply-modifier from-group="enemy_strike" exclude-tags="1 2 7 8"></apply-modifier>
						<apply-modifier from-group="bug_buff" exclude-tags="1 2 3 4"></apply-modifier>
						<apply-modifier from-group="enemy_scurry" exclude-tags="5 6 7 8"></apply-modifier>
						<apply-modifier>
							<unit-mod><apply-status status="basic_ai"></apply-status></unit-mod>
						</apply-modifier>
						<copy preferred-locations="CC F1 F2 F3"></copy>
						<copy preferred-spawn="F1 F2 F3"></copy>
					</result>
					<result value="range">
						<appearance name="Spitty Poly"></appearance>
						<apply-modifier from-group="enemy_shoot" exclude-tags="1 2 7 8"></apply-modifier>
						<apply-modifier from-group="bug_spit_web" exclude_tags="1 2 3 4"></apply-modifier>
						<apply-modifier from-group="enemy_scurry" exclude-tags="5 6 7 8"></apply-modifier>
						<apply-modifier>
							<unit-mod><apply-status status="basic_ai"></apply-status></unit-mod>
						</apply-modifier>
						<copy preferred-locations="B1 B2 B3"></copy>
						<copy preferred-spawn="M1 M2 M3 B1 B2 B3"></copy>
					</result>
				</choose>
			</unit-gen>
			
			<!-- Constructs and Scenery -->
			<unit-gen name="barricade">
				<unit bp="immobile_construct"></unit>
				<copy team="neutral"></copy>
				<appearance appearance="üß±" name="Barricade"></appearance>
			</unit-gen>

			<unit-mod-group for="bug">
				<unit-mods group="bug_buff">
					<unit-mod mod-tags="buff 1"><slot ordinal="1" type="‚≠ê"><skill bp="str_gain"></skill></slot></unit-mod>
					<unit-mod mod-tags="buff 2"><slot ordinal="2" type="‚≠ê"><skill bp="str_gain"></skill></slot></unit-mod>
					<unit-mod mod-tags="buff 3"><slot ordinal="3" type="‚≠ê"><skill bp="str_gain"></skill></slot></unit-mod>
					<unit-mod mod-tags="buff 4"><slot ordinal="4" type="‚≠ê"><skill bp="str_gain"></skill></slot></unit-mod>
					<unit-mod mod-tags="buff 5"><slot ordinal="5" type="‚≠ê"><skill bp="str_gain"></skill></slot></unit-mod>
					<unit-mod mod-tags="buff 6"><slot ordinal="6" type="‚≠ê"><skill bp="str_gain"></skill></slot></unit-mod>
					<unit-mod mod-tags="buff 7"><slot ordinal="7" type="‚≠ê"><skill bp="str_gain"></skill></slot></unit-mod>
					<unit-mod mod-tags="buff 8"><slot ordinal="8" type="‚≠ê"><skill bp="str_gain"></skill></slot></unit-mod>
				</unit-mods>
				<unit-mods group="bug_spit_web">
					<unit-mod mod-tags="1"><slot ordinal="1" type="‚≠ê"><skill bp="bug_spit_web"></skill></slot></unit-mod>
					<unit-mod mod-tags="2"><slot ordinal="2" type="‚≠ê"><skill bp="bug_spit_web"></skill></slot></unit-mod>
					<unit-mod mod-tags="3"><slot ordinal="3" type="‚≠ê"><skill bp="bug_spit_web"></skill></slot></unit-mod>
					<unit-mod mod-tags="4"><slot ordinal="4" type="‚≠ê"><skill bp="bug_spit_web"></skill></slot></unit-mod>
					<unit-mod mod-tags="5"><slot ordinal="5" type="‚≠ê"><skill bp="bug_spit_web"></skill></slot></unit-mod>
					<unit-mod mod-tags="6"><slot ordinal="6" type="‚≠ê"><skill bp="bug_spit_web"></skill></slot></unit-mod>
					<unit-mod mod-tags="7"><slot ordinal="7" type="‚≠ê"><skill bp="bug_spit_web"></skill></slot></unit-mod>
					<unit-mod mod-tags="8"><slot ordinal="8" type="‚≠ê"><skill bp="bug_spit_web"></skill></slot></unit-mod>
				</unit-mods>
			</unit-mod-group>

			<!-- Props and constructs.-->
			<unit-blueprint name="immobile_construct">
				<appearance appearance="üß±" name="Construct"></appearance>
				<base-stats damage="0" defense="0" cunning="0" move="0" mass="9000" hp="30"></base-stats>
				<copy construct="true"></copy>
			</unit-blueprint>


			<concept hash="block">
				<info-panel>
					<h2>Block and Vulnerability</h2>

					<p>A unit with a üõ°Ô∏è next to their HP bar with a number in it has Block.  When receiving attack damage, Block is spent before HP is.</p>
					<p>Sometimes a unit may have a üí• next to their HP instead.  This unit is Vulnerable, and any attack damage they take will be increased by this amount.</p>
					<p>Vulnerability can be directly reduced by gaining block.  For example, a unit with 5üí• will have 3üõ°Ô∏è if they gained 8 block.</p>
					<p>Block does not stack; the largest source of block will overwrite smaller sources of block.</p>
					
				</info-panel>
			</concept>

			<concept hash="taunt">
				<info-panel>
					<h2>Taunt</h2>

					<p>A unit with a üéØ next to their avatar is taunted.</p>
					<p>Taunted enemies are prioritized by your units for attack, if possible.</p>
					<p>Only one unit for a given team may be taunted in a given cell block.</p>
					<p>New taunts take priority.  Old taunts are stored and are restored if the currently-taunted unit loses their taunt status.</p>
				</info-panel>
			</concept>


			<concept hash="combo">
				<info-panel>
					<h2>Combo</h2>

					<p>When 2 or more units Combo, they use their <span compendium="concept/skills">skills</span> as normal, but they will be powered up by each other.</p>
					<p>2 units can combo if one more more of the following is true: <ul>
						<li>They have the same birth month (üî•üå™Ô∏èüíß‚õ∞Ô∏è)</li>
						<li>They have the same or adjacent birth days (üåïüåñüåóüåòüåëüåíüåìüåî)</li>
					</ul>
					Units that can't normally combo together can if there's a unit to act as social glue.</p>

					<p>Units can only combo if they are using moves in the same volley.  In other words, look for moves that have the same cooldown!</p>

					<p style="font-style: italic;">For example, üî•üåï and üíßüåë can combo together if üî•üåë is there to help!</p>
				</info-panel>

			</concept>


			<concept hash="activation">
				<info-panel>
					<h2>Activation</h2>

					<p>A unit is activated whenever it could possibly act, regardless of whether it is in a valid position for a given ability.</p>
					<p>The skill for an activation only occurs if the unit is in the right <span compendium="concept/position">position</span> or if close-quarters combat conditions are met.</p>
					<p>Units may have up to 5 possible activations.  Activations have a cooldown.  Once an activation cooldown reaches 1, the unit will use that ability on their next volley.</p>
					<p>If a unit has multiple activations with a cooldown of 1, the left-most one will be activated.</p>
					<p>Under certain situations, units that activate together may <span compendium="concept/unit/concept/combo">combo</span>.</p>
					<p></p>
				</info-panel>
			</concept>
		</concept>

		<concept hash="status">
			<info-panel>
				<h2>Status</h2>

				<p>Units can have statuses, which are represented above their avatar on the battlefield.</p>
				
				<p>At the time of writing, the following statuses exist: <ul>
					<li>üè≥Ô∏è: This unit will retreat once this reaches 0.  A retreated unit returns to your discard pile if it's yours, or simply leaves the battlefield if it's an enemy unit.</li>
					<li>üí®: This unit is moving, but was unable to move last time it tried.  Each stack can help the unit move further on a single activation.</li>
					<li>ü©∏: This unit will take this amount of damage (bypasses block) whenever it attempts to use an ability.  After taking damage, the number of of stacks will reduce to half its current value.</li>
					<li>üí´: This unit cannot combo with other units.</li>
				</ul></p>
			</info-panel>


			<!-- Orders -->
			<status-blueprint type="retreat_order" exclusive="order" icon="" extra-classes="hidden" apply-fn="RetreatOrder.onApply" remove-fn="RetreatOrder.onRemove" merge-fn="RetreatOrder.merge"></status-blueprint>
			<status-blueprint type="reposition_order" exclusive="order" icon="" extra-classes="hidden" apply-fn="RepositionOrder.onApply" remove-fn="RepositionOrder.onRemove">
				<handler label="RepositionOrder" handler="RepositionOrder.OnAfterVolley" event-types="Volley:after"></handler>
			</status-blueprint>

			<!-- Statuses -->
			<status-blueprint type="defend" icon="" extra-classes="hidden" extra-types="Defend" merge-fn="DefendStatus.merge" stack-fn="DefendStatus.stack">
			</status-blueprint>

			<status-blueprint type="retreating" icon="üè≥Ô∏è" extra-class="" merge-fn="RetreatStatus.merge">
				<handler label="Retreating" handler="RetreatStatus.OnAfterVolley" event-types="Volley:after"></handler>
			</status-blueprint>

			<status-blueprint type="agility" icon="üí®" extra-class="" merge-fn="AgilityStatus.merge">
				<handler label="Agility" handler="AgilityStatus.OnAfterVolley" event-types="Volley:after"></handler>
			</status-blueprint>

			<status-blueprint type="bleed" icon="ü©∏" extra-class="" merge-fn="BleedStatus.merge">
				<handler label="Bleed" handler="BleedStatus.OnAfterUseAbility" event-types="UseAbility:after"></handler>
			</status-blueprint>

			<status-blueprint type="distracted" icon="üí´" extra-class="" merge-fn="DistractedStatus.merge" remove-fn="DistractedStatus.onRemove" apply-fn="DistractedStatus.onApply">
				<handler label="Distracted" handler="DistractedStatus.TickDownMaybe" event-types="UseAbility:after"></handler>
			</status-blueprint>

			<status-blueprint type="base_damage" icon="üí™" extra-class="" merge-fn="BaseDamageStatus.merge" stack-fn="BaseDamageStatus.onStackChange" remove-at-zero="true">
			</status-blueprint>

			<status-blueprint type="base_defense" icon="üõ°Ô∏è" extra-class="" merge-fn="BaseDefenseStatus.merge" stack-fn="BaseDefenseStatus.onStackChange" remove-at-zero="true">
			</status-blueprint>

			<!-- Enemy AI / etc -->
			<status-blueprint type="rat_ai" exclusive="ai" icon="" extra-classes="hidden">
				<handler label="DecideTargetLocation" handler="RatAI.OnAfterVolley" event-types="Volley:after"></handler>
			</status-blueprint>
			<status-blueprint type="jimmy_ai" exclusive="ai" icon="" extra-classes="hidden">
				<handler label="DoJimmyThings" handler="JimmyAI.OnAfterVolley" event-types="Volley:after"></handler>
			</status-blueprint>
			<status-blueprint type="jimmy_blessing" icon="ü§¥" extra-classes="" apply-fn="JimmyBlessing.onApply" remove-fn="JimmyBlessing.onRemove" >
			</status-blueprint>

			<status-blueprint type="bug_curl_up" icon="‚û∞">
				<handler label="AfterDamage" handler="BugEnemy.CurlUpAfterHit" event-types="TakeDamage:after"></handler> 
			</status-blueprint>
			<status-blueprint type="web_damage_reduction" icon="üï∏Ô∏è">
				<handler label="BeforeDamage" handler="WebObstacle.BeforeDamage" event-types="TakeDamage:before"></handler> 
			</status-blueprint>

			<!-- Some generic enemy AIs -->
			<status-blueprint type="basic_ai" exclusive="ai" icon="" extra-classes="hidden">
				<handler label="DecideTargetLocation" handler="BasicAI.OnAfterVolley" event-types="Volley:after"></handler>
			</status-blueprint>

		</concept>

		<concept hash="position">
			<info-panel>
				<h2>Position</h2>

				<p>The position of a unit determines what <span compendium="concept/skills">skills</span> will <span compendium="concept/unit/concept/activation">activate</span>.</p>
				<p>A unit's effective position (front, middle, back) is based on a combination of its literal position and the direction the squad is facing.</p>
				<p style="font-style: italic;">For example, a unit facing up in the top row is in the front row.  If the squad then faces down, the unit is now in the back row.</p>
				<p>Some abilities indicate activity on their directional arrow.  This implies the ability is active if there are enemy units in the unit's block, or if the unit is in an enemy block.</p>
			</info-panel>
		</concept>

		<concept hash="round">
			<info-panel>
				<h2>Round</h2>

				<p>A round begins once you push the big play button.  A round will continue until the combat ends, or you click the button again to stop the action.</p>
				<p>The top number in the ‚åõ indicates how many <span compendium="concept/volley">volleys</span> must occur before you can end the round.  You can still click the button to experience the combat one volley at a time, but the round will not end until this timer reaches 0.  Once it reaches 0, you will also draw a card.</p>
				<p>The bottom number in the ‚åõ indicates how many <span compendium="concept/volley">volleys</span> over the minimum have occurred.  This doesn't do anything yet, but I'm hoping to add a Push-your-luck sort of feature to the game around this.</p>
			</info-panel>
		</concept>

		<concept hash="volley">
			<info-panel>
				<h2>Volley</h2>

				<p>A single <span compendium="concept/round">round</span> is broken into a number of volleys.</p>
				<p>During a volley, any unit actions that can be triggered (e.g. due to positioning) with a cooldown value of 1 or less will happen.</p>
			</info-panel>
		</concept>
		

		<concept hash="features">
			<info-panel>
				<h2>Future Features</h2>

				<ul>
					<li>Preparation Cards: Costs money to play, but provide immediate benefits for the unit/squad.</li>
					<li>Unit Promotions: Allows you to add new activations/skills to units, along with passive abilities.</li>
					<li>Skill Upgrades: Allows you to add special combo-powers to skills.</li>
					<li>Outer Loop: A single run will be 1 year, cycling through 32 days, with a boss fight after each 8th day.</li>
				</ul>

			</info-panel>
		</concept>


		<uihelp hash="encounter">
			<uihelp hash="speedbutton">
				<info-panel>
					<h2>Speed Control</h2>

					<p>Controls how fast the flow of combat goes.  Click to change.</p>
					<p>üêå: Slow! Useful for pausing at the right time.</p>
					<p>üêï: Regular Speed!</p>
					<p>üçë: Hold onto your butts!</p>
				</info-panel>
			</uihelp>
		</uihelp>
	</div>	

	<!-- Put them all in one place to hide them. -->
	<div class="templates">

		<template name="event_global_state">
			<event-state wt="EventState"></event-state>
		</template>

		<template name="modal_dialog">
			<div class="modal_screen modal_dialog"></div>
		</template>

		<template name="unit_select_screen">
			<div wt="Dialog" class="unit_select dialog EXTRA_CLASSES" minimum_units="MINIMUM_UNITS" maximum_units="MAXIMUM_UNITS"
			    wh-c="Accept.click>UnitSelect.Accept,
					  Cancel.click>UnitSelect.Cancel,
					  Card.Attr:selected>UnitSelect.OnSelected,
					  Card.mouseover>UnitSelect.OnHover"
				wh-b="Card.click>Card.ToggleSelected">
				<div class="header"><span class="first"></span></div>
				<div class="option_header">Select Cards</div>
				<div class="option_holder stumpy_cards"></div>
				<div class="unit_preview exploded_cards" facing="up"></div>
				<div class="selected_header">Selected Cards</div>
				<div class="selected_holder stumpy_cards"></div>
				<div class="button_holder">
					<div class="info">Select between MINIMUM_UNITS and MAXIMUM_UNITS units!</div>
					<button wt="Accept">Accept</button>
					<button wt="Cancel">Cancel</button>
				</div>

			</div>
		</template>

		<template name="manage_items_dialog">
			<div wt="Dialog" class="manage_items dialog EXTRA_CLASS"
			screen-label="Manage Items" tutorial-label="tutorial/manageitems"
			    wh-c="Okay.click>ManageItemsDialog.Accept,
					  EmptyAll.click>ManageItemsDialog.EmptyAll"
				wh-b="Card.click>ManageItemsDialog.CardClicked,
					  Item.click>ManageItemsDialog.ItemClicked">
				<div class="header"><span class="first"></span></div>
				<div class="storage_header"></div>
				<div class="storage_holder stumpy_cards"></div>
				<div class="units_holder stumpy_cards"></div>
				<div class="unit_preview exploded_cards" facing="up"></div>
				<div class="button_holder">
					<button wt="EmptyAll">Empty All Units</button>
					<button wt="Okay">Done</button>
				</div>
			</div>
		</template>
		
		<template name="shop_dialog">
			<div wt="Dialog" class="shop_dialog dialog EXTRA_CLASS"
			screen-label="Shop" tutorial-label="tutorial/shop"
			    wh-c="Okay.click>ShopDialog.Done"
				wh-b="Card.click>ShopDialog.ShopItemClick,
					  Tab.click>ShopDialog.TabClicked">				
				<div class="header"><span class="appearance_holder"></span><span class="name_holder"></span><span class="quote_holder"></span></div>				
				<div class="inventory_header"></div>
				<div class="inventory_holder stumpy_cards"></div>

				<div class="tab_controls">
					<div wt="Tab" mode-class="view_storage" class="unit_tab"></div>
					<div wt="Tab" mode-class="view_units" class="unit_tab"></div>
				</div>

				<!-- Tab 1: Looking at storage. -->
				<div class="storage_header"></div>
				<div class="storage_holder stumpy_cards"></div>

				<!-- Tab 2: Looking at units.  -->
				<div class="units_holder stumpy_cards"></div>
				<div class="unit_preview exploded_cards" facing="up"></div>

				<div class="button_holder">
					<button wt="Okay">Done</button>
				</div>
			</div>
		</template>

		<template name="shop_item">
			<div class="shop_item"wt="ShopItem">		
				<div class="card_holder"></div>		
				<div class="price_holder"></div>
			</div>
		</template>

		<template name="embark_dialog">
			<div wt="Dialog" class="embark_dialog dialog EXTRA_CLASS"
					screen-label="Embark" tutorial-label="tutorial/embark"
					wh-c="Okay.click>EmbarkDialog.Accept,
						  Cancel.click>EmbarkDialog.Cancel,
						  Reset.click>EmbarkDialog.Reset"
		  			wh-b="Card.click>EmbarkDialog.ClickCard,
					  	  AddUnit.click>EmbarkDialog.ClickAddUnit">
				<div class="header"></div>
				<div class="units_holder stumpy_cards">
				</div>
				<div class="assignment_holder stumpy_cards"></div>
				<div class="button_holder">
					<button wt="Reset">Reset Assignments</button>
					<button wt="Cancel">Wait, go back to town</button>
					<button wt="Okay">Embark!</button><span class="pending_cost" cost="0"></span>
				</div>
			</div>
		</template>		
		
		<template name="title_screen">
			<div class="title_screen modal_screen" wt="Screen TitleScreen" screen-label="Title Screen" tutorial-label="tutorial/title2">
				<h1> JSOBP Prototype</h1>

				Welcome to the JSOBP prototype!

				<p>Right click on things you want to learn more about.  Many of them have mini-wiki pages, which will show up on the panel to the right.</p>
				<p style="background: rgba(0, 0, 255, 0.5); font-weight: bolder;"><span compendium="tutorial/title">Right-Click Here if you don't know how to play and look to the panel in the upper-right of your screen!</span></p>

				<br />

				<p><button class="start_button" wt="StartButton" wh-c="StartButton.click>TitleScreen.OnStart">Start!</button></p>
				<p><input class="seed_input" type="text" placeholder="Seed (in progress!)"></input></p>

				<p><span compendium="concept/coolseeds">Seeds</span></p>

				<p><span compendium="concept/ideas">Future Ideas</span></p>

				<div>
					<span>Version History</span>
					<ul>
						<li><span compendium="version/0.0.1">V0.0.1</span></li>
						<li><span compendium="version/0.0.2">V0.0.2</span></li>
						<li><span compendium="version/0.0.3">V0.0.3</span></li>
						<li><span compendium="version/0.0.4">V0.0.4</span>  <span compendium="version/0.0.4.1">V0.0.4.1</span></li>
						<li><span compendium="version/0.0.5">V0.0.5</span> <span compendium="version/0.0.5.1">V0.0.5.1</span> <span compendium="version/0.0.5.2">V0.0.5.2</span> <span compendium="version/0.0.5.3">V0.0.5.3</span> <span compendium="version/0.0.5.4">V0.0.5.4</span>  <span compendium="version/0.0.5.5">V0.0.5.5</span> <span compendium="version/0.0.5.6">V0.0.5.6</span> <span compendium="version/0.0.5.7">V0.0.5.7</span> <span compendium="version/0.0.5.8">V0.0.5.8</span></li>
						<li><span compendium="version/0.0.6">V0.0.6</span> <span compendium="version/0.0.6.1">V0.0.6.1</span> <span compendium="version/0.0.6.2">V0.0.6.2</span></li>
						<li><span compendium="version/0.0.7">V0.0.7</span></li>
					</ul>
				</div>
			</div>
		</template>

		
		<template name="run_screen">
			<div class="run_screen modal_screen" wt="Screen RunScreen" screen-label="New Run"
					ds-scope-name="run" ds-scope-data="{}"
					wh-c="RunInfo.Attr>RunScreen.OnRunInfoChange">
				<info>
					<noise-counters>

					</noise-counters>
				</info>
				<div class="run_bar_container"></div>
				<div class="body_container" wt="ScreenWrapper">
					<div wt="PlaceholderScreen Screen"></div>
				</div>
			</div>
		</template>

		<template name="town_screen">
			<div class="town_screen modal_screen" wt="Screen TownScreen" screen-label="Town Screen" tutorial-label="tutorial/townscreen"
			    wh-c="BuyRumor.click>TownScreen.BuyRumor,
					  StorageButton.click>TownScreen.ViewStorage,
					  GoShopping.click>TownScreen.GoShopping,
					  Go.click>TownScreen.OnEmbark"
				wh-b="AssignmentHolder.AddChild|AssignmentHolder.RemoveChild>TownScreen.RefreshEmbark">
				<h2>Town</h2>

				<p>Welcome to your town screen.  You can talk to visitors to buy supplies, and you can assign units to rumors to send them on adventures.</p>

				<div class="facility_holder">
					<div class="buttons">
						<button wt="StorageButton">Manage Items</button>
						<button wt="TacticsButton" disabled="true">Manage Tactics <br />(Coming Soon)</button>
					</div>
				</div>


				<div class="visitor_holder"></div>
				
				<div class="rumor_holder">
				</div>

				<div class="assignment_group">
					<div wt="AssignmentHolder" class="assignment_holder">

					</div>
					<div class="button_holder">
						<button class="embark_button" wt="Go">Embark!</button>
					</div>
				</div>


			</div>
		</template>

		<template name="town_visitor">
			<div wt="Visitor" class="town_visitor" compendium="concept/visitor">
				<div class="appearance">
					<div class="month" month="MONTH"></div>
					<div class="day" day="DAY"></div>
					<div class="avatar" appearance="AVATAR"></div>
				</div>
				<div class="name" name="NAME"></div>
				<info wt="VisitorBP"></info>
				<div class="shopping">
					<button wt="GoShopping" class="shopping_button"></button>
					<inventory></inventory>
					<refill></refill>
					<info wt="BP"></info>
				</div>
			</div>
		</template>

		<!-- Structure of a rumor -->
		<template name="town_rumor">
			<div class="town_rumor" wt="Rumor">
				<span class="name" label="NAME"></span>
				<span class="results" compendium="concept/assignments/concept/results"></span>
				<span class="button_container">
					<button wt="BuyRumor" compendium="concept/assignments/concept/cost">
						<span class="cost_appearance" min-cost max-cost bounded></span>
					</button>
				</span>
				<info wt="BP">

				</info>
			</div>
		</template>

		<!-- Structure of an assignent.  -->
		<template name="town_assignment">
			<div class="town_assignment" wt="Assignment" pending-cost="0" compendium="concept/assignments"  compendium-hash-fn="WoofType.buildSelectorFor">
				<div class="quest_text">
					<div class="quest_name" label="NAME"></div>
					<div class="quest_restrictions" req-label=""></div>
				</div>
				<div class="quest_giver"></div>
				<div class="rewards" compendium="concept/assignments/concept/results"></div>
				<div class="populate_units stumpy_cards">
					<div wt="AddUnit" class="add_unit_button"></div>
				</div>
				<info wt="BP AssignmentBP"></info>
			</div>
		</template>

		<!-- Structure of an Event wrapper -->
		<template name="event_screen">
			<div wt="Screen EventScreen" screen-label="LABEL"
					ds-scope-name="event" ds-scope-data="{}"
					class="event_screen">
				<!-- Place to dump a copy of the event blueprint. -->
				<blueprint></blueprint>
				<!-- Place to dump additional results. -->
				<results></results>
				<!-- Place to dump units -->
				<units></units>
				<!-- Place to dump cards-->
				<deck></deck>
				<div wt="ScreenWrapper">
				</div>
			</div>
		</template>
		
		<!-- Structure of an vignette -->
		<template name="vignette_screen">
			<div class="vignette_screen" wt="Screen VignetteScreen" screen-label="Vignette" tutorial-label="tutorial/vignette"
					wh-b="Choice.click>EventRules.PickChoice">
				<div class="story">
					<div class="title"></div>
					<div class="micro_cards units"></div>
					<div class="flavor"></div>
				</div>
				<div class="choices"></div>
			</div>
		</template>
		
		<!-- Structure of a vignette choice. -->
		<template name="vignette_choice">
			<div><button wt="Choice" choice="CHOICE_ID" class="vignette_choice">LABEL</button></div>
		</template>

		<!-- Structure of a combat encounter -->
		<template name="encounter_screen">
			<div  wt="Screen EncounterScreen" screen-label="Encounter Screen" tutorial-label="tutorial/encounterscreen" class="encounter_screen modal_screen"
														wh-c="Card.Attr:selected>CardRules.OnCardSelected,
															  Battlefield.NewUnit>EncounterRules.OnUnitsChanged|Unit.OnUnit,
															  Battlefield.RemovedUnit>EncounterRules.OnUnitsChanged|Unit.onUnitRemoved,
															  Battlefield.UnitMoved>Unit.OnUnit,
															  Unit.Attr:taunt-list>Unit.OnTauntListChange,
															  ActionButton.giveup>EncounterRules.OnGiveUp,
															  ActionButton.go>EncounterRules.OnGo,
															  ActionButton.stop>EncounterRules.OnStop,
															  ActionButton.cancel>EncounterRules.OnCancel,
															  ActionButton.Attr:pending-action>EncounterRules.OnActionButtonPendingAction,
															  CellBlock.Attr:facing>EncounterScreenHandler.OnCellBlockFacingChange|Unit.OnCellBlockFacingChange|Grid.OnCellBlockFacingChange,
															  CellBlock.mouseover>EncounterScreenHandler.OnCellBlockMouseOver,
															  CellBlock.Attr:taunt-priority>Unit.OnTauntPriorityChange,
															  DrawPileUi.click>CardRules.OnDrawPileClick,
															  Unit.Attr:in-block>Unit.onMoveBlock|BattlefieldHandler.onMoveBlock"
														wh-b="GhostUnit.click>EncounterRules.OnGhostUnitClick"														
														max-player-units="5"
														initiative-order="player enemy neutral"
				<!-- Info for battlefield things -->
				<info class="encounter" wt="EncounterBP">
					
				</info>
				<div class="battlefield_widget_container"></div>
				<div class="preview_panel"></div>
				<div class="tldr_panel"></div>
				<div wt="EndConditions" class="end_condition_container"></div>
				<div class="action_button" wt="ActionButton" mode="" wh-c=".click>ActionButton.OnClick">
				</div>
				<div class="volley_tracker" compendium="concept/round"
						wh-b="SpeedButton.click>VolleyCounter.OnSpeedButtonClick,
							  PlayPauseButton.click>VolleyCounter.OnPlayPauseClick|EncounterRules.OnResume,
							  StepButton.click>VolleyCounter.OnStepClick|EncounterRules.OnStep">
					<div wt="StepButton" class="step_button"></div>
					<div wt="PlayPauseButton" class="play_pause_button" options="pause play" current_option="pause"></div>
					<div wt="SpeedButton" class="speed_button" speed_options="1 2 0" current_speed="1"  compendium="uihelp/encounter/uihelp/speedbutton"></div>
					<div class="countdown" minimum-volleys="8" volleys-left="8"></div>
					<div class="countup" volleys-over-min></div>
				</div>
				<div wt="BannerEffect" class="text_banner_effect"></div>
				<div wt="CardHud" class="card_hud_widget full_size_cards" wh-c="CardSet.AddChild|CardSet.RemoveChild|CardSet.MoveFrom|CardSet.MoveTo>CardHud.OnContentChange"></div>
			</div>
		</template>
		
		<!-- Battlefield Root -->
		<template name="battlefield">
			<div wt="Battlefield" class="battlefield_widget" effect-container=":scope > .ui_effect_overlay"
					wh-b=".Attr:smol-x|.Attr:smol-y|.Attr:beeg-x|.Attr:beeg-y>BattlefieldHandler.OnOverlayItemMove,
						  BattleOverlay.AddChild>BattlefieldHandler.OnOverlayItemAdd,
						  BattleOverlay.RemoveChild>BattlefieldHandler.OnOverlayItemRemove,
						  BattleOverlay.MoveTo>BattlefieldHandler.OnOverlayItemMoveTo,
						  CellBlock.Attr:team|BattleOverlay.RemoveChild|.Attr:beeg-x|.Attr:beeg-y>BattlefieldHandler.refreshThreat">
				<div wt="Grid" class="battlefield_widget_inner"></div>
				<div wt="BattleOverlay" class="battlefield_widget_overlay"></div>
				<div class="ui_effect_overlay"></div>
			</div>
		</template>

		<!-- Round Preview Panel -->
		<template name="round_panel">
			<div class="round_panel"
					wh-c="">
				<div class="volleys">
					<div class="units_header">Units</div>

					<div class="volley_header" volley-count="1">1</div><div class="volley_header" volley-count="2">2</div><div class="volley_header" volley-count="3">3</div><div class="volley_header" volley-count="4">4</div><div class="volley_header" volley-count="5">5</div><div class="volley_header" volley-count="6">6</div><div class="volley_header" volley-count="7">7</div><div class="volley_header" volley-count="8">8</div>
				</div>
				<div class="contents">
					<div class="round_panel_team_group" for-team="player">
					</div>			
					<div class="round_panel_team_group" for-team="enemy">
					</div>			
					<div class="round_panel_team_group" for-team="neutral">
					</div>			
				
				</div>
			</div>
		</template>

		<template name="round_panel_group">
			<div class="round_panel_group facing_override" for-block="BLOCK_LABEL">
			</div>			
		</template>

		<template name="round_panel_row">
			<div class="round_panel_row facing_override">
				<div class="round_panel_avatar">

				</div>
				<div class="volley_box" volley-count="1"></div><div class="volley_box" volley-count="2"></div><div class="volley_box" volley-count="3"></div><div class="volley_box" volley-count="4"></div><div class="volley_box" volley-count="5"></div><div class="volley_box" volley-count="6"></div><div class="volley_box" volley-count="7"></div><div class="volley_box" volley-count="8"></div>
			</div>			
		</template>

		<!-- For the engine. -->
		<template name="game_effect">
			<game-effect w-id="ID" wt="Effect" type="TYPE" phase="before">
				<results></results>
				<queue></queue>
			</game-effect>
		</template>

		<template name="game_effect_result">
			<game-effect-result type="TYPE" value=""></game-effect-result>
		</template>
		
		<!-- Template for an icon that grows, then disappears. -->
		<template name="icon_wub_ui_effect">
			<div wt="UiEffect" class="wub_ui_effect" wh-b="UiEffect.Create>UiTreatments.OnTempIconCreate">
			  CONTENT
			</div>
		</template>
		
		<!-- Template for an icon that grows, then disappears. -->
		<template name="banner_contents">
			<div wt="UiEffect" wh-b="UiEffect.Create>UiTreatments.OnBannerContentCreate" class="EXTRA_CLASSES"></div>
		</template>

		<template name="text_banner_wrapper">
			<span>CONTENT</span>
		</template>


		<!-- Template for an icon that grows, then disappears. -->
		<template name="text_ui_effect">
			<div wt="UiEffect" class="text_ui_effect" wh-b="UiEffect.Create>UiTreatments.OnTempTextCreate"
				style="color: COLOR; text-shadow: -1px -1px 0 SHADOW, 0 -1px 0 SHADOW, 1px -1px 0 SHADOW, 1px 0 0 SHADOW, 1px 1px 0 SHADOW, 0 1px 0 SHADOW, -1px 1px 0 SHADOW, -1px 0 0 SHADOW;">
			  CONTENT
			</div>
		</template>
		
		<!-- Structure of our card HUD -->
		<template name="card_hud">
			<div wt="DrawPileUi" class="deck" compendium="concept/cards/concept/drawpile">
			  <div wt="CardSet DrawPile" class="content" team-id="Player"></div>
			  <div class="size"></div>
			</div>
			<div class="discard"  compendium="concept/cards/concept/discard">
			  <div wt="CardSet Discard" class="content" team-id="Player"></div>
			  <div class="size"></div>
			</div>
			<div wt="HandRules" class="hand" at-least="5" at-most="10" wh-c=".click>CardHud.OnCardSelect">
			  <div wt="CardSet Hand" class="content" team-id="Player"></div>
			  <div class="size"></div>
			</div>
			<div wt="CardPurgatory" class="purgatory"></div>
		</template>
		
		<!-- Structure of a card -->
		<template name="card">
			<div wt="Card" class="card" compendium="concept/cards/concept/card" w-id="ID">			
			</div>
		</template>

		<template name="token">
			<div wt="Token" class="token" compendium="concept/token" w-id="ID">			
			</div>
		</template>
		
		<template name="tactic">
			<div class="tactic" card-type="tactic" target-fn="TARGET_FN" invoke-fn="INVOKE_FN">
				<div class="card_bubble" card-icon="CARD_ICON" compendium="concept/tactics"><div tactic-type="TACTIC_SHORTLABEL"></div></div>
				<div class="name">TACTIC_LABEL</div>
				<div class="description">TACTIC_DESCRIPTION</div>
			</div>
		</template>

		<template name="combo">
			<div class="combo_card" wt="Combo" card-type="combo" compendium="concept/combos" compendium-hash-fn="WoofType.buildSelectorFor">
				<div class="appearance">
					<div class="cooldown" cooldown="9000" reset-cooldown="9000"></div>
				</div>
				<div class="name" label="Combo name here!"></div>
				<div class="recipe"></div>
				<div class="description"></div>

				<info wt="BP"></info>
			</div>
		</template>

		<template name="preparation">
			<div class="preparation" wt="Item" name="NAME" card-type="preparation" target-fn="TARGET_FN" invoke-fn="INVOKE_FN" compendium="concept/preparations" compendium-hash-fn="WoofType.buildSelectorFor">
				<div class="appearance APPEARANCE_CLASS" appearance-1="APPEARANCE_1" appearance-2="APPEARANCE_2">
					<div class="cost" cost="COST"></div>
				</div> 
				<div class="name" label="LABEL"></div>
				<div class="uses" uses="USES"></div>
				<div class="description">DESCRIPTION</div>
				<info wt="BP"></info>
			</div>
		</template>

		<template name="preparation_use">
			<span class="use"></span>
		</template>
		
		

		<!-- Grids -->
		<template name="beegrow">
			<div class="beeg_grid_row"></div>
		</template>

		<template name="beegcell">
			<div class="beeg_grid_cell" wt="CellBlock" beeg-x="X-LU" beeg-y="Y-LU" beeg-label="LAY-BOH" odd="ODDNESS">
				<div class="underlay">
					<div class="direction_arrow"></div>
				</div>
			</div>
		</template>

		<template name="smolrow">
			<div class="smol_grid_row"></div>
		</template>

		<template name="smolcell">
			<div class="smol_grid_cell" wt="Cell" smol-x="X-LU" smol-y="Y-LU", smol-label="LAY-BOH">
				<div class="icon_hint" direction="left"></div>
				<div class="icon_hint" direction="right"></div>
				<div class="icon_hint" direction="up"></div>
				<div class="icon_hint" direction="down"></div>
				<div class="icon_hint" direction="local"></div>
			</div>
		</template>
		
		<!-- Unit -->
		<template name="unit">
			<div class="battlefield_unit" wt="Unit" card-type="unit" w-id="UNIT_ID" highlight-scroll-to="true" compendium="concept/unit" compendium-hash-fn="WoofType.buildSelectorFor"
					target-fn="UnitRules.TargetUnitPlacement" invoke-fn="UnitRules.InvokeUnitPlacement"
					wh-c="
					    Ability.Updated>Unit.OnUnit,
						Ability.AddChild>Ability.HoverHelpRefresh,
						Unit.Attr:month|Unit.Attr:day|Unit.Attr:avatar>Unit.RefreshAppearance"
					month="" day="" appearance="" mana="" mana-fn="Mana.DefaultMana" hover-help="[hover-on-unit='UNIT_ID']" stopped="true">
				<div class="appearance no_transition">
					<div class="month" month=""></div>
					<div class="day" day=""><span></span></div>
					<div class="avatar" appearance=""></div>
				</div>
				<div class="name" name=""></div>
				<div class="help_taunt"><div class="decor"></div></div>
				<div class="hurt_taunt"><div class="decor"></div></div>
				<div class="hp_tracker">
					<progress class="hp_bar" wt="HPBar" max="0" value="0"> </progress>
					<div class="defend"><div class="decor"></div></div>
				</div>

				<!-- Base is copied into non-base during combat. -->
				<div class="battle_script_base"></div>
				<div class="battle_script">
					<div class="cooldown_view"></div>
					<div class="next_icon_view"></div>
				</div>

				<div class="unit_status"></div>

				<inventory max-items="2"></inventory>
				<combos max-items="2"></combos>
				<info wt="UnitBP"></info>
				<info wt="ModBP"></info>
		</div>
		</template>

		<template name="move_slot">
			<div class="move_slot" wt="MoveSlot"
					wh-c="Move.Attr:inactive>MoveSlot.OnMoveActiveChange" inactive="true">
				<div class="appearance">
					<div class="name" moveset_name="Unarmed"></div>
					<div class="description"></div>
				</div>

				<!-- The moves go here. -->
				<div class="move_container"></div>

				<!-- Timing Info -->
				<div class="current_cooldown" current-cooldown="8"></div>
				<div class="cooldown_duration" cooldown-duration="8"></div>
				<div class="warmup" warmup-time="8"></div>
			</div>

		</template>

		<template name="move">
			<!-- These hang out in move slots. -->
			<div class="move" wt="Move" compendium="concept/skills" priority="0" inactive="false">
				<div class="appearance_holder" move_icon="‚ùì"></div>
				<info wt="MoveBP"><!-- Blueprint goes here!--></info>
			</div>
		</template>

		<template name="unit_status">
			<div wt="Status" class="status STATUS_CLASS" status_type="STATUS_TYPE"
					wh-c="Status.Attr:stack_count>BaseStatus.OnStackCountChange">
				<div class="status_icon" status_icon="STATUS_ICON"></div>
				<div class="stack_count" stack_count="0"></div>
				<info wt="BP"></info>
			</div>
		</template>

		<template name="handler-set">
			<handler-set wt="HandlerSet"></handler-set>
		</template>

		<template name="target_context">
			<target-context context="CONTEXT" ticket="TICKET" effect="EFFECT"></target-context>
		</template>
		
		<template name="run_bar">
			<div class="run_bar">
				Day: <div class="day_cycle" month="MONTH" day="DAY"></div>
				<div class="gold_container">
					<span class="icon_before" icon="üü°" current-gold="GOLD"></span>
				</div>
			</div>
		</template>

		<template name="run_info">
			<run-info seed="seeds_not_supported_yet">
				<!-- Where we track things for the run (like amount of gold, etc) -->
				<info wt="RunInfo" current-gold="0" day="üåñ" month="‚õ∞Ô∏è"></info>
				<deck wh-c=".AddChild>Ability.HoverHelpRefresh">
					<!-- Where we store cards between encounters. -->

				</deck>
				<rumors>
					<!-- Where we jam available rumors that aren't associated with other visitors. -->
					
				</rumors>

				<visitors>					
					<!-- Where you jam visitors outside of known areas. -->

				</visitors>

				<storage>
					<!-- Where you jam items not in unit inventories. -->

				</storage>

				<units>

				</units>

				<graveyard>

				</graveyard>
				<workspace>
					<!-- Where I jam misc data about the run, like available names and appearance options. -->
				</workspace>
			</run-info>
		</template>
		
		<template name="combo_banner">
			<div class="combo_banner">Combo:</div>
		</template>
	</div>
	
	<!-- Trigger code at the bottom -->
	<script>

	require("woof/woof").then(function() {
		return Promise.all([
			requireAll(
				// Base libs.
				"woof/noise",
				"woof/ui",
				"woof/queue",
				"woof/domscript",
				"controllers/savemanager",
				
				// Noise counters for RNG.
				"content/noisecounters",

				// Basic components.
				"ui/actionbutton",
				"ui/attrs",
				"ui/battlefield",
				"ui/encounterscreen",
				"ui/card",
				"ui/cardhud",
				"ui/compendiums",
				"ui/dialogscreen",
				"ui/effects",
				"ui/eventscreen",
				"ui/grids",
				"ui/hoverhelper",
				"ui/mainscreen",
				"ui/roundpanel",
				"ui/runbar",
				"ui/runinfo",
				"ui/runscreen",
				"ui/screen",
				"ui/titlescreen",
				"ui/townscreen",
				"ui/tutorialhelper",
				"ui/unit",
				"ui/move", // Uses UnitGen._rng in static initializer
				"ui/volleycounter",

				"ui/shared/unitselect",

				"ui/town/assignment",
				"ui/town/embarkscreen",
				"ui/town/manageitems",
				"ui/town/rumor",
				"ui/town/shopdialog",
				"ui/town/visitor",

				// Misc shit.
				// TODO: Try to get rid of this one.
				"controllers/cards",

				// Gameplay rules

				"rules/cardrules",
				"rules/encounterrules",
				"rules/eventrules",
				"rules/gamerules",
				"rules/targetpicker",
				"rules/unitrules",

				// Constants
				"content/constants",
				"content/teams",

				// Content
				"content/encounters",
				"content/enemies",
				"content/events",
				"content/moves",
				"content/orders",
				"content/preparations",
				"content/skillutils",
				"content/statuses",
				"content/tactics",
				"content/units",
				"content/unitskills",
				"content/visitors",
				"ob"
			),
			loadDataFrames({
				// System templates.
				"woof": "data_frames/woof_templates.html",
				"unit_names": "data_frames/unit_names.html"
			})
		]);
	}).then(function() {
		// Register our document root to be handled by the framework.
		WoofRootController.addRoot(document.body, [
		"hashchange"
		]);

		// Create a console widget where appropriate.
		var consoleContainerBoy = document.querySelector(".console_widget")
		TestConsole.create(consoleContainerBoy);
		TestConsole.focus(consoleContainerBoy);
				
		var mainScreen = document.getElementsByClassName("main_screen")[0];		
		// Initialize our main screen handler.
				
		// Run whatever test you wanted to run.
		
		if (window.location.hash) {
			InfoPanel.navigateTo(document.body, window.location.hash.substring(1));
		}

		var titleScreen = TitleScreen.inflate();
		Screen.showScreen(document.body, titleScreen);
	});
	
	</script>

</body>

</html>